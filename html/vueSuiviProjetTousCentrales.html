<?php include_once 'outils/constantes.php'; ?>
<div id="grid" ></div>
<script>
    var grid, dataStore, store;
    require([
        "dojox/grid/DataGrid",
        "dojo/store/Memory",
        "dojo/data/ObjectStore",
        "dojo/request",
        "dojo/date/stamp",
        "dojo/date/locale",
        "dojo/domReady!"
    ], function(DataGrid, Memory, ObjectStore, request, stamp, locale) {
        request.get("<?php echo '/'.REPERTOIRE; ?>/tmp/projetTousCentrales.json", {
            handleAs: "json"}).then(function(data) {
            store = new Memory({data: data.items});
            dataStore = new ObjectStore({objectStore: store});
            
            function hrefFormatterPDF(index, idx) {
                var item = grid.getItem(idx);
                var numero = item.numero;
                return "<a  href=\"<?php echo '/'.REPERTOIRE; ?>/pdf_project/<?php echo $lang; ?>/" + numero + "\" target='_blank'>" +
                        '<img title="<?php echo TXT_GENERERPDF; ?>" src="<?php echo '/'.REPERTOIRE; ?>/styles/img/pdf_icongrid.png" />' + "</a>";
            }
            
            function formatDate(datum) {
                var d = stamp.fromISOString(datum);
                return locale.format(d, {selector: 'date', formatLength: 'long'});
            }
            grid = new DataGrid({
                store: dataStore,
                query: {id: "*"},
                structure: [
                    {name: "<?php echo TXT_NUMERO; ?>", field: "numero", width: "100px"},
                    {name: "<?php echo TXT_DATEDEMANDE; ?>", field: "dateprojet", width: "130px", formatter: formatDate},
                    {name: "<?php echo TXT_TITREPROJET; ?>", field: "titre", width: "220px  "},
                    {name: " ", field: "imprime", width: "34px", formatter: hrefFormatterPDF},                 
                    {name: "<?php echo TXT_STATUTPROJET?>", field: "libellestatutprojet", width: "110px"},
                    {name: "<?php echo TXT_NOMDEMANDEUR?>", field: "nom", width: "110px"},
                    {name: "<?php echo TXT_NOMLABORATOIRE?>", field: "entrepriselaboratoire", width: "110px"},
                    {name: "<?php echo TXT_NOMENTREPRISE ?>", field: "nomentreprise", width: "110px"},
                    {name: "<?php echo TXT_CENTRALE ?>", field: "libellecentrale", width: "50px"}
                ]
            }, "grid");
            grid.startup();
        });
    });
</script>
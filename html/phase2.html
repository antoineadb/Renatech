<?php 
if(isset($_GET['numProjet'])){
    $idprojet=$manager->getSingle2("select idprojet from projet where numero=?",$_GET['numProjet']);
}elseif(isset($_GET['idprojet'])){
    $idprojet=$_GET['idprojet'];
}
if(isset($_GET['statut'])){
    $statut=$_GET['statut'];
}else{
       $statut=$manager->getSingle2("select idstatutprojet_statutprojet from concerne where idprojet_projet=?", $idprojet);
}

if($statut==ENCOURSREALISATION || $statut ==FINI || $statut==CLOTURE){    
    if(isset($_GET['numProjet'])){
        $numero  = $_GET['numProjet'];
    }elseif(isset($_GET['idprojet'])){
        $numero = $manager->getSingle2("select numero from projet where idprojet=?",$_GET['idprojet']);
    }
    $datedebutProjet = $manager->getSingle2("select datedebutprojet from projet where numero =? ",$numero);
    if(!empty($datedebutProjet)){
        $date = new DateTime($datedebutProjet);
        $date  = $date->format('Y-m-d');
}
}
?>
<fieldset>
    <legend style="width: 850px;padding-left: 20px">
        <b><?php echo TXT_NUMPROJET.' : '.$numProjet;?></b> - <b><?php echo TXT_ACRONYMEPROJET.' : '.stripslashes(str_replace("''","'",$acronyme));  ?></b>        
    </legend>
    <?php 
    $dateStatutFini = $manager->getSingle2('select datestatutfini from projet where idprojet = ?',$idprojet);
    $dateFini = new DateTime($dateStatutFini);
    $dateFini  = $dateFini->format('d-m-Y');
    
    switch ($idstatutprojet) {
        case "":
            echo '<legend style="margin-left:20px"><b>' . TXT_STATUTPROJETS . ': ' . TXT_ATTENTE . '</b></legend>'; //projet en attente
            $bool = 'false';
            $bool1 = '';
            $disabled = "''";
            break;
        case ENATTENTEPHASE2:
            echo '<legend style="margin-left:20px"><b>' . TXT_STATUTPROJETS . ': ' . TXT_ATTENTE . '</b></legend>'; //projet en attente
            $bool = 'false';
            $bool1 = '';
            $disabled = "''";
            break;
        case ENCOURSANALYSE:
            echo '<legend style="margin-left:20px"><b>' . TXT_STATUTPROJETS . ': ' . TXT_CONSULT . '</b></legend>'; //Projet En cours d'analyse
            $bool = 'true';
            $bool1 = 'true';
            $disabled = "'disabled'";
            break;
        case ACCEPTE:
            echo '<legend style="margin-left:20px"><b>' . TXT_STATUTPROJETS . ': ' . TXT_ACCEPTE . '</b></legend>'; //projet Acceptée
            $bool = 'false';
            $bool1 = '';
            $disabled = "''";
            break;
        case REFUSE:
            echo "<fieldset class='statut' ><b>" . TXT_PROJECT . " " . TXT_REFUSE . "</b></fieldset>";
            $bool = 'false';
            $bool1 = '';
            $disabled = "'disabled'";
            break;
        case FINI:
            echo "<fieldset class='statut' ><b>" . TXT_PROJECT . " " . TXT_FINI . " le : ".$dateFini."</b></fieldset>";
            $bool = 'false';
            $bool1 = '';
            $disabled = "''";
            break;
        case CLOTURE:
            echo "<fieldset class='statut' ><b>" . TXT_PROJECT . " " . TXT_CLOTURE . "</b></fieldset>";
            $bool = 'false';
            $bool1 = '';
            $disabled = "''";
            break;
        case ENCOURSREALISATION:
            echo '<legend style="margin-left:20px"><b>' . TXT_STATUTPROJETS . ': ' . TXT_ENCOURSREALISATION . '</b></legend>'; //projet en cours de réalisation
            $bool = 'false';
            $bool1 = '';
            $disabled = "''";
            break;
        case ENATTENTEPHASE2:
            echo '<legend style="margin-left:20px"><b>' . TXT_STATUTPROJETS . ': ' . TXT_ENATTENTE . '</b></legend>'; //projet en attente phase2
            $bool = 'false';
            $bool1 = '';
            $disabled = "'disabled'";
            break;
            default:
    }?>
<?php 
if(isset($_GET['statut'])){
    $idstatut = $_GET['statut'];
}else{
    $idstatut = $manager->getSingle2("SELECT  idstatutprojet_statutprojet FROM concerne,projet WHERE idprojet_projet = idprojet and idprojet = ?",$idprojet);
}?>
    <?php 
        if(!empty($datedebutProjet)){
$date = new DateTime($datedebutProjet);
            if($_SESSION['idTypeUser']==ADMINLOCAL && empty($dateStatutFini) ){
             $date  = $date->format('Y-m-d'); ?>        
            <fieldset class='datedebutprojet' >
                <b><?php echo TXT_DATEDEBUTPROJET.' : '?>
                    <input type='text' data-dojo-type="dijit/form/DateTextBox" id="date_debut_projet"  value="<?php echo $date; ?>" onchange="
                        if(confirm('<?php echo TXT_MESSAGEUPDATEDATEDEBUTPROJET; ?>')){
                        var d = new Date(this.value);
                        var newDate =  d.getFullYear() + '-' + (d.getMonth()+1) + '-' + d.getDate();
                        modifDateDebutProjet('/<?php echo REPERTOIRE; ?>/modifBase/modifDateDebut.php?date=' + newDate+'&idprojet=<?php echo $idprojet?>'); 
                    }else{
                        document.getElementById('majDateDebutProjet').style.display='none';
                        document.getElementById('NomajDateDebutProjet').style.display='Block';
                    }
                    
                           
                           ">
                </b>
            </fieldset>        
             <label id='majDateDebutProjet' style="display: none;color: #B71701;width:350px;margin-left:150px;font-weight: bold;margin-top: -15px;"><?php echo TXT_MESSAGEUPDATEDATEDEBUTPROJET ; ?></label>
             <label id='NomajDateDebutProjet' style="display: none;color: #B71701;width:450px;margin-left:150px;font-weight: bold;margin-top: -15px;"><?php echo TXT_MESSAGENOUPDATEDATEDEBUTPROJET ; ?></label>
            <?php }else{ 
$date  = $date->format('d-m-Y');
?>
<fieldset class='datedebutprojet' ><b><?php echo TXT_DATEDEBUTPROJET.' : '.$date;  ?></b></fieldset>
<?php }?>
<?php   }?>
<input type='text' id='affiche_centrale_proximite' style='display: none' value='non'>
<input name="page_precedente" type="hidden" value="<?php echo basename(__FILE__) ; ?>">
        <table style='width:1050px'>
            <tr>
                <td>
                    <div class='pdfmp'>
                        <a href="<?php echo '/'.REPERTOIRE.'/pdf_project/'.$lang.'/'.$numProjet; ?>" target="_blank" title="<?php echo TXT_GENERERPDF ;?>"><img src="<?php echo '/'.REPERTOIRE; ?>/styles/img/pdf_icon.png"  ></a>
                    </div>
                    <div style="margin-top: -35px;padding-left: 930px;">
                            <a href="#"  title="<?php echo TXT_RAPPORTWORD ;?>" onclick="window.location.replace('<?php echo '/'.REPERTOIRE;?>/Run_project/<?php echo $lang.'/'.$numProjet.'/'.$idstatut.'/'.rand(0, 10000);?>')"><img src="<?php echo '/'.REPERTOIRE; ?>/styles/img/folder.jpg"  ></a>
                    </div>
                   <input type='checkbox' data-dojo-type='dijit/form/CheckBox' id='ongletRapport'  style="display: none" >
                </td>
            </tr>
        </table>
        <table style="border-collapse:collapse;margin-top:10px;">
        <tr>
            <th class="titreEnteteProjet" ><?php echo TXT_DEMANDEUR;?></th>
            <th class="titreEnteteProjet" ><?php echo TXT_PORTEURS;?></th>
        <?php if(!empty($listeadminprojet)){?>
            <th class="titreEnteteProjet"><?php echo TXT_ADMINPROJET;?></th>
        <?php }?>
        </tr>
        <tr>
            <td class="enteteProjet"><?php echo $demandeur.'<br/>'.$emaildemandeur;?></td>
            <td class="enteteProjet"><?php echo $sporteur;?></td>
        <?php if(!empty($listeadminprojet)){?>
            <td class="enteteProjet"><?php echo $listeadminprojet;?></td>
        <?php }?>
        </tr>
        
        </table>
        <?php if($_SESSION['idTypeUser']==ADMINLOCAL){?>
        <table style="border-collapse:collapse;width:210px;margin-top:10px;">
            <tr>
                <th style="border: 1px solid gray;padding-left:5px;background-color: #E4F0FC;text-align: center"><?php echo TXT_NOMLABO;?> <a class="infoBulle" href="#"><img src='<?php echo "/".REPERTOIRE; ?>/styles/img/help.gif' height="13px" width="13px"/>
                                        <span style="text-align: left;padding:10px;width: 310px;border-radius:5px" ><?php echo affiche('TXT_AIDEMODIFACRONYME');?></span>
                                    </a></th>
                <th style=""></th>
            </tr>            
            <tr><td>
                    <?php 
                        $acronymeLabo = $manager->getSingle2("SELECT acronymelaboratoire FROM projet,creer,utilisateur WHERE idutilisateur_utilisateur = idutilisateur AND idprojet_projet = idprojet and idprojet = ?",$idprojet);
                        $iddemandeur =  $manager->getSingle2("SELECT idutilisateur FROM projet,creer,utilisateur WHERE idutilisateur_utilisateur = idutilisateur AND idprojet_projet = idprojet and idprojet = ?",$idprojet);
                    ?>
                    <input data-dojo-type="dijit/form/ValidationTextBox"   id="acronymeLabo"                         
                           style="text-align: center;width: 300px;border: 1px solid gray;" value='<?php echo $acronymeLabo; ?>'  />                   
                </td>
                <td>
                    <div style="margin-top: -10px">
                        <input type="button" class="arrondi" value="" 
                               onclick="modifAcronymeLabo('/<?php echo REPERTOIRE; ?>/modifBase/modifAcronymeLabo.php?lang=<?php echo $lang; ?>&acronyme=' + dijit.byId('acronymeLabo').get('value') +
                                           '&iddemandeur=<?php echo $iddemandeur;?>')"> 
                        <span style="text-align: left;padding:10px;width: 310px;border-radius:5px;margin-left: 20px" id="idElement">&nbsp;</span>   
                    </div>
                </td>
                <td><label style="display: none;color: red;margin-left:20px" id="afficheMessage" ><?php echo TXT_ACRONYMEMODIFIER; ?></label></div></td>
            </tr>
        </table>
        <?php } ?>
        <?php if(!empty($_GET['msgerrdescontexte'])){?>
        <table>
            <tr>
                <td>
                    <fieldset class='msgerrdescontexte' >
                        <legend><?php echo TXT_ERR;?></legend>
                        <?php 	echo stripslashes($_GET['msgerrdescontexte']).'<br>';?>
                    </fieldset>
                </td>
            </tr>
        </table>    
        <?php } ?>
        <fieldset id="identre" >
            <legend style="margin-left: 20px;font-weight: bold"><?php echo TXT_CADREPROJETSCIENTIFIQUE;?></legend>
        <table>            
            <tr>
                <td><?php $contactscentraleaccueil = stripslashes(str_replace("''","'",$contactscentraleaccueil)); ?>
                    <label for="contactCentralAccueil" id='lblContactCentraleAccueil' style="margin-left:20px"><?php echo TXT_CONTACTCENTRALACCUEIL;?><?php echo ' :';?></label>
                    <?php if (strpos($_SERVER['HTTP_USER_AGENT'], 'MSIE') !== FALSE) {?>
                    <input  value="<?php echo $contactscentraleaccueil ;?>"  type="text"  maxlength="100" data-dojo-type="dijit/form/ValidationTextBox" name= "contactCentralAccueil"  
                           autocomplete="on" data-dojo-props="<?php echo REGEX_TYPE; ?>"  data-dojo-invalidMessage="<?php echo TXT_ERRSTRING ;?>" <?php echo $disabled ?> >
                           <?php }else{?>
                           <input style="margin-left:20px" value="<?php echo $contactscentraleaccueil ;?>"  type="text" maxlength="100"   data-dojo-type="dijit/form/ValidationTextBox" name= "contactCentralAccueil"  autocomplete="on"
                            data-dojo-props="<?php echo REGEX_TYPE; ?>"  disabled="<?php echo $bool; ?>" data-dojo-invalidMessage="<?php echo TXT_ERRSTRING ;?>" />
                    <?php }?>
                </td>
            </tr>
        </table>        
        <table>            
            <tr>
                <td>
                    <label for="typeProjet" style="width: 260px;margin-left: 20px;margin-top:15px" ><?php echo TXT_TYPEPROJET.'*';?><?php echo ' :';?></label>
                    <?php
                    $rowTypeprojet =
                    $manager->getListbyArray("select libelletype,libelletypeen,idtypeprojet from typeprojet where  libelletype!=? and libelletype !=? and masquetypeprojet!=TRUE order by idtypeprojet asc",array('n/a',$libelletype)); ?>
                    <select name="typeProjet" id="typeProjet" data-dojo-type="dijit/form/Select" style="width: 220px;margin-left: 20px;"
                            onchange="afficheGrpFormation(this.id)" onreadystatechange="afficheGrpFormation(this.id)" disabled="<?php echo $bool; ?>"
                            required="true" >
                        <?php
                        if($lang=='fr'){
                            if (!empty($libelletype)){
                                $index = $manager->getSingle2("select idtypeprojet from typeprojet where libelletype=?",$libelletype);
                                echo "<option  value='".'tp'.$index."'>".str_replace("''","'",$libelletype)."</option>";
                            }else{
                                echo "<option  >".TXT_SELECTTYPEPROJET.'</option>';
                            }
                            $nbrowTypeprojet=count($rowTypeprojet);
                            for($i=0;$i<$nbrowTypeprojet;$i++){
                                echo "<option  value='".'tp'.$rowTypeprojet[$i]['idtypeprojet']."'>".
                                str_replace("''","'",$rowTypeprojet[$i]['libelletype'])."</option>";
                            }
                        }elseif($lang=='en'){
                            if (!empty($libelletypeen)){
                                $index = $manager->getSingle2("select idtypeprojet from typeprojet where libelletypeen=?",$libelletypeen);
                                echo "<option  value='".'tp'.$index."'>".$libelletypeen."</option>";
                            }else{
                                echo "<option >".TXT_SELECTTYPEPROJET.'</option>';
                            }
                            $nbrowTypeprojet=count($rowTypeprojet);
                            for($i=0;$i<$nbrowTypeprojet;$i++){
                                echo "<option  value='".'tp'.$rowTypeprojet[$i]['idtypeprojet']."'>".
                                str_replace("''","'",$rowTypeprojet[$i]['libelletypeen'])."</option>";
                            }
                        }
                        ?>
                    </select>
                </td>                
                <td style="display:none;margin-top: 15px;" id="grpTypeFormation">
                    <?php $typeformation = stripslashes(str_replace("''",	"'",	$typeformation))?>
                    <label for="typeFormation" style="width: 260px;margin-left: 20px;" ><?php echo TXT_TYPEFORMATION;?><?php echo ' :*';?></label>
                    <?php
                    $rowTypeformation = $manager->getListbyArray("select libelletypeformation,libelletypeformationen,idtypeformation from typeformation
                    where  libelletypeformation !=? and masquetypeformation!=TRUE order by idtypeformation asc",array('n/a'));
                    ?>
                    <select name="typeFormation" id="typeFormation" data-dojo-type="dijit/form/Select" style="width: 220px;margin-left: 20px;"  disabled="<?php echo $bool; ?>" >
                        <?php
                        if($lang=='fr'){
                            if (!empty($libelletypeformation)){
                                $index = $manager->getSingle2("select libelletypeformation from typeformation where libelletype=?",$libelletypeformation);
                                echo "<option style='' value='".'tf'.$index."'>".str_replace("''","'",$libelletypeformation)."</option>";
                            }else{
                                echo "<option style=''>".TXT_SELECTTYPEFORMATION.'</option>';
                            }
                            $nbrowTypeformation =count($rowTypeformation);
                            for($i=0;$i<$nbrowTypeformation;$i++){
                                echo "<option style='' value='".'tf'.$rowTypeformation[$i]['idtypeformation']."'>".str_replace("''","'",
                                $rowTypeformation[$i]['libelletypeformation'])."</option>";
                            }
                        }elseif($lang=='en'){
                            if (!empty($libelletypeformation)){
                                $index = $manager->getSingle2("select libelletypeformationen from typeformation where libelletype=?",$libelletypeformation);
                                echo "<option style='' value='".'tf'.$index."'>".str_replace("''","'",$libelletypeformation)."</option>";
                            }else{
                                echo "<option style=''>".TXT_SELECTTYPEFORMATION.'</option>';
                            }
                            $nbrowTypeformation =count($rowTypeformation);
                            for($i=0;$i<$nbrowTypeformation;$i++){
                                echo "<option style='' value='".'tf'.$rowTypeformation[$i]['idtypeformation']."'>".str_replace("''","'",
                                $rowTypeformation[$i]['libelletypeformationen'])."</option>";
                            }
                        }
                        ?>
                    </select>
                </td>
            </tr>
        </table>
        <script>
            function afficheGrpFormation(id) {
                if ((dijit.byId(id).value) === 'tp5' || dijit.byId(id).get('displayedValue') === 'Formation') {//Formation
                    document.getElementById('grpTypeFormation').style.display = 'block';
                    document.getElementById('blocnbHeureEleve').style.display = 'block';
                    dijit.byId('nbHeure').set('required', 'true');
                    dijit.byId('nbeleve').set('required', 'true');
                    dijit.byId('typeFormation').set('required', 'true');
                } else {
                    document.getElementById('grpTypeFormation').style.display = 'none';
                    document.getElementById('blocnbHeureEleve').style.display = 'none';
                    dijit.byId('nbHeure').set('required', '');
                    dijit.byId('nbeleve').set('required', '');
                    dijit.byId('typeFormation').set('required', '');
                }
            }
        </script>
        <table style="display: none" id="blocnbHeureEleve">
            <tr>
                <td>
                    <label for="nbHeure" style="width: 260px;margin-left: 20px;" ><?php echo TXT_NBHEURE;?><?php echo ' *:';?></label>
                    <input type="text" name="nbHeure" id="nbHeure"  value="<?php echo $nbheure;?>" data-dojo-type="dijit/form/NumberTextBox" style="margin-left: 20px;" autocomplete="on" disabled="<?php echo $bool; ?>" />
                </td><td>
                    <label for="nbeleve" style="width: 260px;margin-left: 20px;" ><?php echo TXT_NBELEVE;?><?php echo ' *:';?></label>
                    <input type="text" name="nbeleve" id="nbeleve"  value="<?php echo $nbeleve;?>" data-dojo-type="dijit/form/NumberTextBox" style="margin-left: 20px;" autocomplete="on" disabled="<?php echo $bool; ?>" />
                </td>            
            <tr><td><?php
                    if(!empty($nomformateur)){
                        $nomformateur=str_replace("''", "'",$nomformateur);
                    }
                    ?>

                    <label for="nomformateur" style="width: 260px;margin-left: 20px;" ><?php echo TXT_NOMFORMATEUR;?><?php echo ' :';?></label><input id="nomformateur" value="<?php echo $nomformateur ;?>" type="text" data-dojo-type="dijit/form/ValidationTextBox" name= "nomformateur"  autocomplete="on" style="margin-left: 20px;" disabled="<?php echo $bool; ?>" />
                </td></tr>
        </table>
        <table>            
            <tr><script>require(["dojo/parser", "dijit/form/NumberTextBox"]);</script>
            <td>
                <label for="dureeprojet" style="width: 200px;margin-left: 20px;margin-top:10px"><?php echo TXT_DUREEPROJET.':*'; ?></label>
                <input id="dureeprojet" type="text" data-dojo-type="dijit/form/NumberTextBox" name= "dureeprojet"  autocomplete="on"
                       value="<?php echo $dureeprojet; ?>"  required="true" data-dojo-props="invalidMessage:'valeur non valide.'" style="margin-left: 20px;" disabled="<?php echo $bool; ?>" />
                <?php
                if($lang=='fr'){
                    if(empty($libelleperiodicite)){
                        $rowperiodicite =$manager->getListbyArray("select idperiodicite,libelleperiodicite from period where libelleperiodicite !=? and libelleperiodicite !=?",array($libelleperiodicite, TXT_MOIS));
                    }elseif($libelleperiodicite!=TXT_MOIS){
                        $rowperiodicite =$manager->getListbyArray("select idperiodicite,libelleperiodicite from period where libelleperiodicite !=? ",array($libelleperiodicite));
                    }else{
                        $rowperiodicite =$manager->getListbyArray("select idperiodicite,libelleperiodicite from period where libelleperiodicite !=? and libelleperiodicite !=?",array($libelleperiodicite, TXT_MOIS));
                    }
                }elseif($lang=='en'){
                    if(empty($libelleperiodiciteen)){
                        $rowperiodicite =$manager->getListbyArray("select idperiodicite,libelleperiodiciteen from period where libelleperiodiciteen !=? and libelleperiodiciteen !=?",array($libelleperiodiciteen, TXT_MOIS));
                    }elseif($libelleperiodicite!=TXT_MOIS){
                        $rowperiodicite =$manager->getListbyArray("select idperiodicite,libelleperiodiciteen from period where libelleperiodiciteen !=? ",array($libelleperiodiciteen));
                    }else{
                        $rowperiodicite =$manager->getListbyArray("select idperiodicite,libelleperiodiciteen from period where libelleperiodiciteen !=? and libelleperiodiciteen !=?",array($libelleperiodiciteen, TXT_MOIS));
                    }
                }
                ?>
                <select name="choix" id="choix" data-dojo-type="dijit/form/Select"  disabled="<?php echo $bool; ?>" >
                    <?php
                    if($lang=='fr'){
                        if(!empty($libelleperiodicite)){
                        $index = $manager->getSingle2("select idperiodicite from period where libelleperiodicite=?",$libelleperiodicite);
                            echo "<option value='".'pe'.$index."'>".$libelleperiodicite."</option>";//SI LA VALEUR A DEJA ETE SAISIE
                        }else{
                            echo "<option value='pe2' selected='selected' >".TXT_MOIS."</option>";
                        }
                        $nbrowperiodicite =count($rowperiodicite);
                        for($i=0;$i<$nbrowperiodicite;$i++){
                            echo "<option value='".'pe'.$rowperiodicite[$i]['idperiodicite']."'>".$rowperiodicite[$i]['libelleperiodicite']."</option>";
                        }
                    }elseif($lang=='en'){
                        if(!empty($libelleperiodiciteen)){
                            $index = $manager->getSingle2("select idperiodicite from period where libelleperiodicite=?",$libelleperiodiciteen);
                            echo "<option value='".'pe'.$index."'>".$libelleperiodiciteen."</option>";//SI LA VALEUR A DEJA ETE SAISIE
                        }else{
                            echo "<option value='pe2' selected='selected' >".TXT_MOIS."</option>";
                        }
                        $nbrowperiodicite =count($rowperiodicite);
                        for($i=0;$i<$nbrowperiodicite;$i++){
                            echo "<option value='".'pe'.$rowperiodicite[$i]['idperiodicite']."'>".$rowperiodicite[$i]['libelleperiodiciteen']."</option>";
                        }
                    }
                    ?>
                </select>
            </td>
            </tr>            
            <tr>
                <td>
                    <?php include 'outils/sourceFinancement.php'; ?>
                </td>
            </tr>            
        </table>
        <?php 
            $sSourcefinancement='';
            $arrraySF= $manager->getList2("select idsourcefinancement_sourcefinancement,libellesourcefinancementen,acronymesource from projetsourcefinancement,sourcefinancement where idsourcefinancement_sourcefinancement=idsourcefinancement and idprojet_projet=?",$idprojet);
            $nbSF=count($arrraySF);
            for($i=0;$i<$nbSF;$i++){
                if($arrraySF[$i]['idsourcefinancement_sourcefinancement']==IDAUTRESOURCEFINANCEMENT){
                    $sSourcefinancement.=$arrraySF[$i]['acronymesource'].',';
                }else{
                    $sSourcefinancement.=$arrraySF[$i]['libellesourcefinancementen'].',';
                }
            }
            $s_Sourcefinancement = substr($sSourcefinancement,0,-1);
            ?>
            <input type="text" value='<?php if(!empty($s_Sourcefinancement)){ echo $s_Sourcefinancement;} ?>' style="display: none" id='sourceFinancement'>
            <?php
            //collaborator
                $s_Collaborator='';
                $_acolaborator = $manager->getList2("select centralepartenaireprojet from projet where idprojet=?",$idprojet);
                $s_Collaborator = $_acolaborator[0]['centralepartenaireprojet'].', ';
                if(!empty($_acolaborator)){
                    $arraycollaborator = $manager->getList2("select nomlaboentreprise from partenaireprojet,projetpartenaire where idpartenaire_partenaireprojet= idpartenaire and idprojet_projet=?",$idprojet);
                    $nbarraycollaborator = count($arraycollaborator);
                    for($i=0;$i<$nbarraycollaborator;$i++){
                        $s_Collaborator.=$arraycollaborator[$i]['nomlaboentreprise'].', ';
                    }
                }
                $s_collaborator=substr($s_Collaborator,0,-2);
                
                $ressources='';
                $arrayressource = $manager->getList2("select libelleressourceen from ressourceprojet,ressource  where idressource=idressource_ressource  and idprojet_projet=?",$idprojet);                
                $nbarrayressource = count($arrayressource);
                for($i=0;$i<$nbarrayressource;$i++){
                    $ressources.= $arrayressource[$i]['libelleressourceen'].', ';                    
                }                
                $stringRessource = substr($ressources,0,-2);
            ?>
            <input type="text" value='<?php if(!empty($s_collaborator)){ echo $s_collaborator;} ?>' style="display: none" id='collaborators'>
            <input type="text" value='<?php if(!empty($stringRessource)){ echo $stringRessource;} ?>' style="display: none" id='technicalworks'>            
            <table style="margin-top: 10px">
            <tr>
                <td>
                    <label for="porteurProjet"  style="width: 445px;margin-left: 20px;"><?php echo TXT_QUESTIONPORTEURPROJET.' : *'; ?></label>
                </td>
                <td>
                    <?php if($porteurProjet=='TRUE'){?>
                    <input type= "radio" data-dojo-type="dijit/form/RadioButton" name="porteurprojet"  value="TRUE"	checked="checked" class="btRadio" disabled="<?php echo $bool; ?>"
                           onclick="disablednomlabo('/<?php echo REPERTOIRE; ?>/outils/disabledNomlabo.php?lang=<?php echo $lang;?>&porteur=' + this.value + '')">
                    <?php echo TXT_OUI;?>
                    <input type= "radio" data-dojo-type="dijit/form/RadioButton" name="porteurprojet" value="FALSE"  class="btRadio" disabled="<?php echo $bool; ?>"
                           onclick="disablednomlabo('/<?php echo REPERTOIRE; ?>/outils/disabledNomlabo.php?lang=<?php echo $lang;?>&porteur=' + this.value + '')">
                    <?php echo TXT_NON; ?>
                    <td>
                    <label id='msgporteurProjet' style="width: 350px;margin-left:20px;display: none;"  ><?php echo TXT_MSGPORTEURPROJET ?></label>
                </td>
                <?php }else{?>
                    <input type= "radio" data-dojo-type="dijit/form/RadioButton" name="porteurprojet"  value="TRUE" class="btRadio" disabled="<?php echo $bool; ?>"
                           onclick="disablednomlabo('/<?php echo REPERTOIRE; ?>/outils/disabledNomlabo.php?lang=<?php echo $lang;?>&porteur=' + this.value + '')">
                    <?php echo TXT_OUI; ?>
                    <input type= "radio" data-dojo-type="dijit/form/RadioButton" name="porteurprojet" value="FALSE" checked="checked"  class="btRadio" disabled="<?php echo $bool; ?>"
                           onclick="disablednomlabo('/<?php echo REPERTOIRE; ?>/outils/disabledNomlabo.php?lang=<?php echo $lang;?>&porteur=' + this.value + '')">
                    <?php echo TXT_NON;?>
                    </tr>                    
                <tr>
                <td>
                    <label id='msgporteurProjet' style="width: 350px;margin-left:20px;display: block;"  ><?php echo TXT_MSGPORTEURPROJET ?></label>
                </td>
                <?php }?>
            </tr>
        </table>
        <input id="reponsenomlabo" value='' style="display: none" >
        <fieldset id="dev" style="border-color: #5D8BA2;width:966px;padding-top: 0px;margin-top:20px;margin-left: 20px;padding-left:0px;">
            <legend style="margin-left: 20px;"><?php echo TXT_PARTENAIRE;?><a class="infoBulle" href="#">&nbsp;<img src='<?php echo "/".REPERTOIRE; ?>/styles/img/help.gif' height="13px" width="13px"/>
            <span style="text-align: left;padding:10px;width: 290px;border-radius:5px" >
                 <?php //MISE EN CACHE DES AIDES
                            if(!$aidepartenaireprojet=$Cache->read('aidepartenaireprojet')){
                                $aidepartenaireprojet=affiche('TXT_AIDEPARTENAIREPROJET') ;
                                $Cache->write('aidepartenaireprojet',$aidepartenaireprojet);
                            }?><?= $aidepartenaireprojet; ?></span></a>
            </legend>
            <table>                
                <tr>
                    <td>
                        <?php
                        $arraypartenaire = $manager->getList2("select partenaire1,centralepartenaireprojet from projet where idprojet=?",$idprojet);
                        if(trim($arraypartenaire[0]['partenaire1'])=='' && trim($arraypartenaire[0]['centralepartenaireprojet'])==''){
                            $nbpartenaire = 0;
                        }else{                            
                            $nbpartenaire = $manager->getSingle2("select count(idpartenaire_partenaireprojet) from projetpartenaire where idprojet_projet =?",$idprojet);
                            if($nbpartenaire>0){
                                $nbpartenaire = $nbpartenaire+1;
                            }else{
                                $nbpartenaire = 1;
                            }
                        }
                        
                        ?>
                        <label style="width: 400px;margin-left: 20px;"><?php echo TXT_NBPARTENAIRE_PROJET.' : '.'( 0 - 10 )'; ?></label>
                    </td>
                <script>
                    dojo.ready(function() {
                        var spinner = dijit.byId("integerspinner2");
                        var spinner1 = dijit.byId("integerspinner");
                        var currentValue = spinner.get('value');
                        var currentValue1 = spinner1.get('value');
                        dojo.connect(spinner, "onChange", function(value) {
                            currentValue = value;
                        });
                        dojo.connect(spinner1, "onChange", function(value) {
                            currentValue1 = value;
                        });
                        dojo.connect(spinner.domNode, (!dojo.isMozilla ? "onmousewheel" : "DOMMouseScroll"), function(e) {
                            spinner.set('value', currentValue);
                        });
                        dojo.connect(spinner1.domNode, (!dojo.isMozilla ? "onmousewheel" : "DOMMouseScroll"), function(e) {
                            spinner1.set('value', currentValue1);
                        });
                    });
                </script>
                <td>
                    <input data-dojo-type="dijit/form/NumberSpinner" id="integerspinner2" value="<?php if ($nbpartenaire > 0){echo $nbpartenaire;}else{echo 0;}?>" onscroll="return false"
                           data-dojo-props="smallDelta:1, constraints:{min:0,max:10,places:0}" name="nombrePartenaire" style="width:50px;"
                           onchange="addnom(dijit.byId(this.value))" onclick="addnom(dijit.byId(this.value))" disabled="<?php echo $bool; ?>" />
                </td>
                </tr>
            </table>
            <table>                
                <tr id="trcentralepartenaireprojet" style="display: none" >
                    <td>
                        <label style="margin-left: 22px;width:305px" for="<?php	echo	'nomLaboEntreprise'	.	$i;	?>">
                            <?php	echo	TXT_NOMLABOENTREPRISE	.	' 1 *';?>
                        </label>
                        <?php $rowCentrale =$manager->getListbyArray("select idcentrale,libellecentrale from centrale where libellecentrale !=? order by idcentrale asc",array($centralepartenaireprojet)); ?>
                    </td>
                    <td><div id="centralelaboentreprise"></div>
                        <input type="text" id="centralepartenaireprojet" autocomplete="on" name="centralepartenaireprojet" maxlength="100"
                               data-dojo-type="dijit/form/ValidationTextBox" disabled="<?php	echo	$bool;	?>"
                               value="<?php	echo $centralepartenaireprojet ?>"
                               data-dojo-props="regExp:'[a-zA-ZàáâäãåèéêëìíîïòóôöõøùúûüÿýñçčšžÀÁÂÄÃÅÈÉÊËÌÍÎÏÒÓÔÖÕØÙÚÛÜŸÝÑßÇŒÆČŠŽ∂ð%&:0-9\042\'’/=°()*\0133\0135\+_ ,.-]+'">
                    </td>
                </tr>
               <!-- <tr id='trnomPartenaire01'>
                    <td>
                        <label style="margin-left: 22px;width:305px" for="nomPartenaire01">
                            <?php	echo	TXT_NOMPARTENAIRE	.	' 1 '	;	?>
                        </label>
                    </td>
                    <td>
                        <input type="text" id="nomPartenaire01" autocomplete="on" name="nomPartenaire01" data-dojo-type="dijit/form/ValidationTextBox"
                               disabled="<?php	echo	$bool;	?>" 		value="<?php	echo $partenaire1 ?>" maxlength="100"                               
                               data-dojo-props="regExp:'[a-zA-ZàáâäãåèéêëìíîïòóôöõøùúûüÿýñçčšžÀÁÂÄÃÅÈÉÊËÌÍÎÏÒÓÔÖÕØÙÚÛÜŸÝÑßÇŒÆČŠŽ∂ð%&:0-9\042\'’/=°()*\0133\0135\+_ ,.-]+'">
                    </td>
                </tr>-->
            </table>
            <script>
                function addnom(nb) {
                    switch (nb) {
                        case 0:
                            for (i = 0; i < 10; i++) {
                                dijit.byId('centralepartenaireprojet').set('required', '');                                
                                var nom = 'nom' + i;
                                document.getElementById(nom).style.display = 'none';
                                document.getElementById('trcentralepartenaireprojet').style.display = 'none';
                                //document.getElementById('trnomPartenaire01').style.display = 'none';
                                dijit.byId('nomLaboEntreprise' + i).set('required', '');
                            }
                            break;
                        case 1:
                            document.getElementById('trcentralepartenaireprojet').style.display = 'block';
                            ////document.getElementById('trnomPartenaire01').style.display = 'block';                            
                            dijit.byId('centralepartenaireprojet').set('required', 'true');
                            dijit.byId('centralepartenaireprojet').focus();
                            for (i = 0; i < 11; i++) {
                                dijit.byId('nomLaboEntreprise' + i).set('required', '');
                            }
                            for (i = nb - 1; i < 10; i++) {
                                var nom = 'nom' + i;
                                document.getElementById(nom).style.display = 'none';
                            }
                            break;
                        case 2:
                            for (i = 0; i < nb - 1; i++) {
                                document.getElementById('nom' + i).style.display = 'block';
                                dijit.byId('nomLaboEntreprise' + i).set('required', 'true');
                            }
                            dijit.byId('nomLaboEntreprise0').set('required', 'required');
                            for (i = 1; i < 11; i++) {
                                dijit.byId('nomLaboEntreprise' + i).set('required', '');
                            }
                            for (i = nb - 1; i < 10; i++) {
                                var nom = 'nom' + i;
                                document.getElementById(nom).style.display = 'none';
                            }
                            document.getElementById('trcentralepartenaireprojet').style.display = 'block';
                            //document.getElementById('trnomPartenaire01').style.display = 'block';
                            break;
                        case 3:
                            dijit.byId('nomLaboEntreprise0').set('required', 'required');
                            dijit.byId('nomLaboEntreprise1').set('required', 'required');
                            for (i = 2; i < 11; i++) {
                                dijit.byId('nomLaboEntreprise' + i).set('required', '');
                            }
                            for (i = 0; i < nb - 1; i++) {
                                document.getElementById('nom' + i).style.display = 'block';
                            }
                            document.getElementById('trcentralepartenaireprojet').style.display = 'block';
                            //document.getElementById('trnomPartenaire01').style.display = 'block';
                            for (i = nb - 1; i < 10; i++) {
                                var nom = 'nom' + i;
                                document.getElementById(nom).style.display = 'none';
                            }
                            break;
                        case 4:
                            dijit.byId('nomLaboEntreprise0').set('required', 'required');
                            dijit.byId('nomLaboEntreprise1').set('required', 'required');
                            dijit.byId('nomLaboEntreprise2').set('required', 'required');
                            for (i = 3; i < 11; i++) {
                                dijit.byId('nomLaboEntreprise' + i).set('required', '');
                            }
                            for (i = 0; i < nb - 1; i++) {
                                document.getElementById('nom' + i).style.display = 'block';
                            }
                            document.getElementById('trcentralepartenaireprojet').style.display = 'block';
                            //document.getElementById('trnomPartenaire01').style.display = 'block';
                            for (i = nb - 1; i < 10; i++) {
                                var nom = 'nom' + i;
                                document.getElementById(nom).style.display = 'none';
                            }
                            break;
                        case 5:
                            dijit.byId('nomLaboEntreprise0').set('required', 'required');
                            dijit.byId('nomLaboEntreprise1').set('required', 'required');
                            dijit.byId('nomLaboEntreprise2').set('required', 'required');
                            dijit.byId('nomLaboEntreprise3').set('required', 'required');
                            for (i = 4; i < 11; i++) {
                                dijit.byId('nomLaboEntreprise' + i).set('required', '');
                            }
                            for (i = 0; i < nb - 1; i++) {
                                document.getElementById('nom' + i).style.display = 'block';
                            }
                            document.getElementById('trcentralepartenaireprojet').style.display = 'block';
                            //document.getElementById('trnomPartenaire01').style.display = 'block';
                            for (i = nb - 1; i < 10; i++) {
                                var nom = 'nom' + i;
                                document.getElementById(nom).style.display = 'none';
                            }
                            break;
                        case 6:
                            for (i = 0; i < 5; i++) {
                                dijit.byId('nomLaboEntreprise' + i).set('required', 'required');
                            }
                            for (i = 5; i < 11; i++) {
                                dijit.byId('nomLaboEntreprise' + i).set('required', '');
                            }
                            for (i = 0; i < nb - 1; i++) {
                                document.getElementById('nom' + i).style.display = 'block';
                            }
                            document.getElementById('trcentralepartenaireprojet').style.display = 'block';
                            //document.getElementById('trnomPartenaire01').style.display = 'block';
                            for (i = nb - 1; i < 10; i++) {
                                var nom = 'nom' + i;
                                document.getElementById(nom).style.display = 'none';
                            }
                            break;
                        case 7:
                            for (i = 0; i < 6; i++) {
                                dijit.byId('nomLaboEntreprise' + i).set('required', 'required');
                            }
                            for (i = 6; i < 11; i++) {
                                dijit.byId('nomLaboEntreprise' + i).set('required', '');
                            }
                            for (i = 0; i < nb - 1; i++) {
                                document.getElementById('nom' + i).style.display = 'block';
                            }
                            document.getElementById('trcentralepartenaireprojet').style.display = 'block';
                            //document.getElementById('trnomPartenaire01').style.display = 'block';
                            for (i = nb - 1; i < 10; i++) {
                                var nom = 'nom' + i;
                                document.getElementById(nom).style.display = 'none';
                            }
                            break;
                        case 8:
                            for (i = 0; i < 6; i++) {
                                dijit.byId('nomLaboEntreprise' + i).set('required', 'required');
                            }

                            for (i = 7; i < 11; i++) {
                                dijit.byId('nomLaboEntreprise' + i).set('required', '');
                            }
                            for (i = 0; i < nb - 1; i++) {
                                document.getElementById('nom' + i).style.display = 'block';
                            }
                            document.getElementById('trcentralepartenaireprojet').style.display = 'block';
                            //document.getElementById('trnomPartenaire01').style.display = 'block';
                            for (i = nb - 1; i < 10; i++) {
                                var nom = 'nom' + i;
                                document.getElementById(nom).style.display = 'none';
                            }
                            break;
                        case 9:
                            for (i = 0; i < 7; i++) {
                                dijit.byId('nomLaboEntreprise' + i).set('required', 'required');
                            }
                            for (i = 8; i < 11; i++) {
                                dijit.byId('nomLaboEntreprise' + i).set('required', '');
                            }
                            for (i = 0; i < nb - 1; i++) {
                                document.getElementById('nom' + i).style.display = 'block';
                            }
                            document.getElementById('trcentralepartenaireprojet').style.display = 'block';
                            //document.getElementById('trnomPartenaire01').style.display = 'block';
                            for (i = nb - 1; i < 10; i++) {
                                var nom = 'nom' + i;
                                document.getElementById(nom).style.display = 'none';
                            }
                            break;
                        case 10:
                            for (i = 0; i < 9; i++) {
                                dijit.byId('nomLaboEntreprise' + i).set('required', 'required');
                            }
                            for (i = 9; i < 11; i++) {
                                dijit.byId('nomLaboEntreprise' + i).set('required', '');
                            }

                            for (i = 0; i < nb - 1; i++) {
                                document.getElementById('nom' + i).style.display = 'block';
                            }
                            document.getElementById('trcentralepartenaireprojet').style.display = 'block';
                            //document.getElementById('trnomPartenaire01').style.display = 'block';
                            for (i = nb - 1; i < 10; i++) {
                                var nom = 'nom' + i;
                                document.getElementById(nom).style.display = 'none';
                            }
                            break;
                        case 11:
                            for (i = 0; i < 10; i++) {
                                dijit.byId('nomLaboEntreprise' + i).set('required', 'required');
                            }
                            for (i = 0; i < 9; i++) {
                                document.getElementById('nom' + i).style.display = 'block';
                            }
                            document.getElementById('trcentralepartenaireprojet').style.display = 'block';
                            //document.getElementById('trnomPartenaire01').style.display = 'block';
                            break;
                        default:
                            break;
                    }
                }
            </script>
            <div class="partenaire">
                <?php include 'partenaire.php'; ?>
            </div>            
        </fieldset>         
        <table>            
            <tr>
                <td>
                    <label for="thematique" style="margin-bottom: 5px;margin-left: 20px;margin-top: 20px;   width: 300px;" ><?php echo TXT_NATUREPROJET.' :';?></label>
                    <select name="thematique" id="thematique"  data-dojo-type="dijit/form/Select" style="margin-left: 20px;width: 320px;margin-bottom: 20px"
                            onchange="afficherAutre(this.id, 'autreThematique')" disabled="<?php echo $bool; ?>" >
                        <?php
                        if($lang=='fr'){
                            $rowthematique = $manager->getList2("select idthematique,libellethematique from thematique where libellethematique !=?
                            and masquethematique!=TRUE order by idthematique asc ",$libellethematique);
                            if(!empty($libellethematique)){
                                $indexthema = $manager->getSingle2("select idthematique from thematique where libellethematique = ?",$libellethematique);
                                echo "<option value='".'sf'.$indexthema."'>".$libellethematique."</option>";
                            }else{
                                echo '<option>'.TXT_SELECTNATURE.'</option>';
                            }
                            $nbrowthematique=count($rowthematique);
                            for($i=0;$i<$nbrowthematique;$i++){
                                echo "<option value='".'th'.$rowthematique[$i]['idthematique']."'>".$rowthematique[$i]['libellethematique']."</option>";
                            }
                            }elseif($lang=='en'){
                                $rowthematique = $manager->getListbyArray("select idthematique,libellethematiqueen from thematique
                                where libellethematiqueen !=? and masquethematique!=TRUE order  by idthematique asc ",array($libellethematiqueen));
                            if(!empty($libellethematiqueen)){
                                $indexthema = $manager->getSingle2("select idthematique from thematique where libellethematiqueen = ?",$libellethematiqueen);
                                echo "<option value='".'sf'.$indexthema."'>".$libellethematiqueen."</option>";
                            }else{
                                echo '<option>'.TXT_SELECTNATURE.'</option>';
                            }
                            $nbrowthematique=count($rowthematique);
                            for($i=0;$i<$nbrowthematique;$i++){
                                echo "<option value='".'th'.$rowthematique[$i]['idthematique']."'>".$rowthematique[$i]['libellethematiqueen']."</option>";
                            }
                        }
                        ?>
                    </select>
                    <?php
                            $autrethematique = $manager->getSingle2("SELECT libelleautrethematique FROM  projet, autrethematique WHERE
                            idautrethematique = idautrethematique_autrethematique and idprojet=?",$idprojet);
                            $thema= $manager->getSingle2("SELECT libellethematique FROM  projet, thematique WHERE idthematique =
                            idthematique_thematique and idprojet=?",$idprojet);
                    ?>
                    <?php if($thema=='Autres'){?>
                    <?php $autrethematique = stripslashes(str_replace("''",	"'",	$autrethematique)) ;?>
                    <input id="autreThematique" type="text" autocomplete="on" name="autreThematique"
                           data-dojo-type="dijit/form/ValidationTextBox" placeholder="<?php echo TXT_AUTRETHEMATIQUE;?>"
                           style="margin-left: 20px;display:block" value="<?php echo $autrethematique;?>" disabled="<?php echo $bool; ?>"
                           data-dojo-props="<?php echo REGEX_TYPE;?>"                                            
                           data-dojo-invalidMessage="<?php echo TXT_ERRSTRING ;?>"  maxlength="100"  >
                    <?php }else{ ?>
                    <input id="autreThematique" type="text" autocomplete="on" name="autreThematique" disabled="<?php echo $bool; ?>"
                           data-dojo-type="dijit/form/ValidationTextBox" placeholder="<?php echo TXT_AUTRETHEMATIQUE;?>"
                           style="margin-left: 20px;display:none"  data-dojo-invalidMessage="<?php echo TXT_ERRSTRING ;?>"
                           ddata-dojo-props="<?php echo REGEX_TYPE;?>" maxlength="100"  >
                    <?php }
                        if(!empty($libellethematiqueen) && $libellethematiqueen!='Others'){
                            $thematic= $libellethematiqueen;
                        }else{
                        $thematic= $manager->getSingle2("SELECT libelleautrethematique FROM autrethematique,projet WHERE idautrethematique_autrethematique=idautrethematique and idprojet =?",$idprojet);
                        }
                    ?>
                    <input type="text" value='<?php echo $thematic; ?>' style="display: none" id='thematic'>
                </td>
            </tr>
        </table>
        <?php include_once 'outils/specifiqueExport.php'; ?>
        <?php $datedebut = $manager->getSingle2("SELECT datedebutprojet FROM projet WHERE idprojet =?",$idprojet);?>
        <input type="text" value='<?php if(isset($datedebut)){echo $datedebut;} ?>' style="display: none" id='datedebutprojet'>
</fieldset>
        <fieldset id="identsa" style="background-color:#F9FCFC;border-color: #5D8BA2;width:960px;padding-top: 0px;margin-top:5px;padding-left:0px;border-width:2px;padding-right: 0px;margin-left:-3px ">        
            <legend style="margin-left: 20px;font-weight: bold"><?php echo TXT_DEROULPROJETSALLE ;?></legend>
        <table>            
            <tr>
                <td>
                    <label for="dateDebutTravaux" style="width: 350px;margin-left: 20px;margin-top:20px;margin-bottom: 5px"><?php echo TXT_DATEDEBUTTRAVAUX.' * :'; ?></label>
                    <input type="text" name="dateDebutTravaux" id="dateDebutTravaux" value="<?php echo $datedebuttravaux ;?>" data-dojo-type="dijit/form/DateTextBox" 
                           required="true" style="width: 320px;margin-left: 20px;margin-bottom: 5px" autocomplete="on"
                            disabled="<?php echo $bool; ?>" />
                </td>
            </tr>            
            <tr><td>
                <label for="dureeestimeprojet" style="margin-bottom: 5px; margin-left: 20px;width: 600px;margin-top: 15px;"><?php echo TXT_DUREETRAVAUXTECNO.':*'; ?></label>
                <input id="dureeestimeprojet" type="text" data-dojo-type="dijit/form/NumberTextBox" name= "dureeestimeprojet"  autocomplete="on"
                       value="<?php echo $dureeestime; ?>"  required="true" data-dojo-props="invalidMessage:'valeur non valide.'" style="margin-left: 20px;margin-bottom: 20px" disabled="<?php echo $bool; ?>" />
                <?php
                if($lang=='fr'){
                    if(empty($libelleperiodestime)){
                        $rowperiodicite =$manager->getListbyArray("select idperiodicite,libelleperiodicite from period where libelleperiodicite !=? and libelleperiodicite !=?",array($libelleperiodestime, TXT_MOIS));
                    }elseif($libelleperiodestime!=TXT_MOIS){
                        $rowperiodicite =$manager->getListbyArray("select idperiodicite,libelleperiodicite from period where libelleperiodicite !=? ",array($libelleperiodestime));
                    }else{
                        $rowperiodicite =$manager->getListbyArray("select idperiodicite,libelleperiodicite from period where libelleperiodicite !=? and libelleperiodicite !=?",array($libelleperiodestime, TXT_MOIS));
                    }
                }elseif($lang=='en'){
                    if(empty($libelleperiodestimeen)){
                        $rowperiodicite =$manager->getListbyArray("select idperiodicite,libelleperiodiciteen from period where libelleperiodiciteen !=? and libelleperiodiciteen !=?",array($libelleperiodestimeen, TXT_MOIS));
                    }elseif($libelleperiodicite!=TXT_MOIS){
                        $rowperiodicite =$manager->getListbyArray("select idperiodicite,libelleperiodiciteen from period where libelleperiodiciteen !=? ",array($libelleperiodestimeen));
                    }else{
                        $rowperiodicite =$manager->getListbyArray("select idperiodicite,libelleperiodiciteen from period where libelleperiodiciteen !=? and libelleperiodiciteen !=?",array($libelleperiodestimeen, TXT_MOIS));
                    }
                }
                ?>
                <select name="choix2" id="choix2" data-dojo-type="dijit/form/Select"  disabled="<?php echo $bool; ?>" style="margin-bottom: 20px;" >
                    <?php
                    if($lang=='fr'){
                        if(!empty($libelleperiodestime)){
                        $index = $manager->getSingle2("select idperiodicite from period where libelleperiodicite=?",$libelleperiodestime);
                            echo "<option value='".'pe'.$index."'>".$libelleperiodestime."</option>";//SI LA VALEUR A DEJA ETE SAISIE
                        }else{
                            echo "<option value='pe2' selected='selected' >".TXT_MOIS."</option>";
                        }
                        $nbrowperiodicite =count($rowperiodicite);
                        for($i=0;$i<$nbrowperiodicite;$i++){
                            echo "<option value='".'pe'.$rowperiodicite[$i]['idperiodicite']."'>".$rowperiodicite[$i]['libelleperiodicite']."</option>";
                        }
                    }elseif($lang=='en'){
                        if(!empty($libelleperiodestimeen)){
                            $index = $manager->getSingle2("select idperiodicite from period where libelleperiodicite=?",$libelleperiodestimeen);
                            echo "<option value='".'pe'.$index."'>".$libelleperiodestimeen."</option>";//SI LA VALEUR A DEJA ETE SAISIE
                        }else{
                            echo "<option value='pe2' selected='selected' >".TXT_MOIS."</option>";
                        }
                        $nbrowperiodicite =count($rowperiodicite);
                        for($i=0;$i<$nbrowperiodicite;$i++){
                            echo "<option value='".'pe'.$rowperiodicite[$i]['idperiodicite']."'>".$rowperiodicite[$i]['libelleperiodiciteen']."</option>";
                        }
                    }
                    ?>
                </select>
            </td></tr>
            <tr>    
            <script>
                function affiche(id) {
                    if (document.getElementById(id).style.display === 'none') {
                        document.getElementById(id).style.display = '';
                    } else {
                        document.getElementById(id).style.display = 'none';
                    }
                }
            </script>
            <td>
                <fieldset id="ident" style="border-color: #5d8ba2;width: 950px;margin-left:20px">
                    <legend style="color: #5D8BA2;margin-bottom: 5px"><?php echo TXT_PERSONNECENTRALE; ?></legend>
                    <?php
                    $arraypersonne = $manager->getList2("select idpersonneaccueilcentrale_personneaccueilcentrale  from projetpersonneaccueilcentrale where idprojet_projet =?", $idprojet);                    
                    if(isset($_GET['nbpersonne'])&& $_GET['nbpersonne']>count($arraypersonne)) {
                        $nbpersonne = $_GET['nbpersonne'];
                    }else{
                       $nbpersonne = count($arraypersonne);
                    }
                    ;?>
                        <div style="width: 500px;margin-left:45px">&nbsp;<?php echo TXT_SELECTNBPERSONE;?><a class="infoBulle" href="#">
                                <img src='<?php echo "/".REPERTOIRE; ?>/styles/img/help.gif' height="13px" width="13px"/>
                                <span style="text-align: left;padding:10px;width: 550px;border-radius:5px" >
                                    <?php //MISE EN CACHE DES AIDES
                            if(!$aidepersonnecentrale=$Cache->read('aidepersonnecentrale')){
                                $aidepersonnecentrale=affiche('TXT_AIDEPERSONNECENTRALE') ;
                                $Cache->write('aidepersonnecentrale',$aidepersonnecentrale);
                            }?><?= $aidepersonnecentrale; ?>
                                </span></a>
                            <input data-dojo-type="dijit/form/NumberSpinner" id="integerspinner"    onscroll="return false"
                                   value="<?php if ($nbpersonne > 0) {echo $nbpersonne;}else{echo 0;} ?>"
                                   data-dojo-props="smallDelta:1, constraints:{min:0,max:21,places:0}" name="nombrePersonneCentrale"
                                   style="width:60px;margin-left: 20px;" onchange="addnomCentrale(dijit.byId(this.value))"
                                   onclick="addnomCentrale(dijit.byId(this.value))" disabled="<?php echo $bool; ?>" />
                        </div>
                    <div id="personCentrale" style="margin-left: 45px"><?php include 'personneCentrale/personneCentrale.php';  ?></div><br>
                        </fieldset>
            </td>
                        </tr>                                               
                        <tr><td><div style="margin-top: 15px"><?php include 'outils/ressourceCheck.php';?></div></td></tr>                        
                        <tr>
                            <td>
                                <label for="descriptifTechnologique" style="width: 350px;margin-left: 20px;margin-top: 15px">
                                    <?php echo TXT_DESCRIPTIFTECHNOLOGIQUE.' :'; ?>
                                    <a class="infoBulle" href="#"><img src='<?php echo "/".REPERTOIRE; ?>/styles/img/help.gif' height="13px" width="13px"/>
                                        <span style="text-align: left;padding:10px;width: 600px;border-radius:5px" >
                                            <?php echo affiche('TXT_AIDEDESCRIPTIFTECHNOLOGIQUE');?></span></a>
                                </label>
                                <div class="phase2ta" id="descriptifTechnologique" name="descriptifTechnologique" style="margin-left: 20px" >
                                    <?php echo $descriptiftechnologique; ?>
                                </div>
                            </td>
                        </tr>
                        <tr><td><label id="cptdescriptechno" style="width:450px;color:#B71701;margin-left: 20px;margin-bottom: 10px; "></label></td></tr>
                        <tr style="display: none" id="msgerrdescriptechno">
                            <td>
                                <fieldset class='msgerrdescriptechno' ><legend><?php echo TXT_INFO;?></legend>
                                    <?php 	echo stripslashes(TXT_LIMITEDITEURDESCTECHNO).'<br>';?>
                                </fieldset>
                            </td>
                        </tr>
                        <tr>
                            <td style="float:left;background: none no-repeat scroll 15px 50% #529ab7;color: white;font-size: 0.9em;padding: 7px;text-align: center;width: 625px;margin-left:20px">
                            <?php echo TXT_ERREURUPLOAD;?>
                        </td>
                        </tr>
                        <tr>
                            <td>
                                <input name="fichierphase2" type="file" data-dojo-type="dojox/form/Uploader" id="uploaderPhase2" 
                                       style="margin-left: 20px;margin-top: 5px;margin-bottom: 15px" data-dojo-props='label:"<?php echo TXT_ATTACHEMENT;?>"'/>                                
                                <div id="filePhase2" data-dojo-type="dojox/form/uploader/FileList" data-dojo-props='uploaderId:"uploaderPhase2"'
                                     name='file' style="margin-left: 20px;"></div>
                                <?php
                                $attachementdesc  = str_replace("''","'",stripslashes($manager->getSingle2("select attachementdesc from projet where idprojet =?",$idprojet)));
                                $monUrl = "http://".$_SERVER['HTTP_HOST'];
                                if(isset($_GET['erreurupload'])){//SI ERREUR SUR L'ATTACHEMENT ON L'EFFACE
                                    $projetattachementdesc = new Projetattachementdesc($idprojet, '');
                                    $manager->updateProjetattachementdesc($projetattachementdesc,$idprojet);
                                    echo '<label style="color: red;display:block;font-size: small; width: auto;margin-left:20px">'.TXT_ERREURUPLOAD.'</label>';
                                }elseif(isset($_GET['erreuruploadsize'])){//SI ERREUR SUR L'ATTACHEMENT ON L'EFFACE
                                    $projetattachementdesc = new Projetattachementdesc($idprojet, '');
                                    $manager->updateProjetattachementdesc($projetattachementdesc,$idprojet);
                                    echo '<label style="color: red;display:block;font-size: small; width: auto;margin-left:20px">'.TXT_ERREURTAILLEFICHIER.'</label>';
                                }else{
                                    $attachementdesc = addslashes($attachementdesc);
                                    echo '<div id=\'pieceJointe2\' style="margin-left:20px">
                                    <a href="'.$monUrl.dirname($_SERVER['PHP_SELF']).'/uploaddesc/'.$attachementdesc.'" target="_blank" id="attachementdesc">'.$attachementdesc.'</a>
                                    </div><div id=\'btnsuppr2\'></div>';
                                }
                                if(!empty($attachementdesc)){
                                ?>
                                <script>
                                    if (dojo.byId('attachementdesc') !== '') {
                                        document.getElementById('btnsuppr2').innerHTML =
"<br><button class='admin' style='margin-left:20px' onClick='effaceAttachementdesc(\"<?php echo '/'.REPERTOIRE;?>/outils/effaceAttachement.php?idprojet=<?php echo $idprojet; ?>\");' type='button' ><?php echo TXT_SUPPRPIECE?> </button>";
                                    } else {
                                        document.getElementById('btnsuppr2').innerHTML = '';
                                    }
                                </script>
                                <?php }?>
                                <div id='reponsedesc'></div>
                            </td>                            
                        </tr>
                        <script>
                            function verrou(){
                                document.getElementById('verrou').style.display = 'block';
                                document.getElementById('cptverrou').style.display = 'block';
                            }
                            function deverrou(){
                                document.getElementById('verrou').style.display = 'none';
                                document.getElementById('cptverrou').style.display = 'none';
                            }
                            
                        </script>
                        <tr><td>
                                <label for="devTechnologique" style="width:695px;margin-left: 20px;"><?php echo TXT_QUESTIONETAPE.'* :';?>
                                    <a class="infoBulle" href="#"><img src='<?php echo "/".REPERTOIRE; ?>/styles/img/help.gif' height="13px" width="13px"/>
                                        <span style="text-align: left;padding:10px;width: 230px;border-radius:5px" >
                                            <?php echo affiche('TXT_AIDEDESCRIPTIFTECHNO');?></span></a></label>
                                <?php $devtechnologique= $manager->getSingle2("select devtechnologique from projet where idprojet =?",$idprojet);
                                if ($devtechnologique=='TRUE'){?>
                                <input type= "radio" data-dojo-type="dijit/form/RadioButton" name="devTechnologique"   value="TRUE" checked="checked"
                                       class="btRadio" onclick="verrou()" style="margin-left: 20px;">
                                <?php echo TXT_OUI; ?>
                                <input type= "radio" data-dojo-type="dijit/form/RadioButton" name="devTechnologique"  value="FALSE"  class="btRadio"
                                       onclick="deverrou()" style="margin-left: 20px;">
                                <?php echo TXT_NON; ?>
                                <?php }else{ ?>
                                <input type= "radio" data-dojo-type="dijit/form/RadioButton" name="devTechnologique"   value="TRUE"  class="btRadio"
                                       onclick="verrou()" style="margin-left: 20px;">
                                <?php echo TXT_OUI; ?>
                                <input type= "radio" data-dojo-type="dijit/form/RadioButton" name="devTechnologique"  value="FALSE" checked="checked"
                                       class="btRadio" onclick="deverrou()" style="margin-left: 20px;">
                                <?php echo TXT_NON; ?>
                                <?php } ?>
                            </td>
                        </tr>
                        <tr>
                            <?php  if ($devtechnologique=='TRUE'){?>
                            <td  id="verrou" style="display:block">
                                <?php $verrouidentifiee = stripslashes(str_replace("''",	"'",	$verrouidentifiee)) ?>
                                <label for="verrouidentifie" style="width: auto;margin-left: 20px">
                                    <?php echo TXT_VERROUIDENTIFIEE.' :'; ?>
                                    <a class="infoBulle" href="#"><img src='<?php echo "/".REPERTOIRE; ?>/styles/img/help.gif' height="13px" width="13px"/>
                                        <span style="text-align: left;padding:10px;width: 600px;border-radius:5px" >
                                            <?php echo affiche('TXT_AIDEVERROUIDENTIFIEE');?></span></a>
                                </label>
                                <div class="phase2ta" id="verrouidentifie"  name="verrouidentifie" disabled="<?php echo $bool; ?>" >
                                    <?php echo $verrouidentifiee;?></div>
                            </td>
                            <?php }else{ ?>
                            <td  id="verrou" style="display:none">
                                <label for="verrouidentifie" style="width: auto;margin-left: 20px"><?php echo TXT_VERROUIDENTIFIEE.' :'; ?>
                                    <a class="infoBulle" href="#"><img src='<?php echo "/".REPERTOIRE; ?>/styles/img/help.gif' height="13px" width="13px"/><span style="width: 250">
                                            <?php echo affiche('TXT_AIDEVERROUIDENTIFIEE');?></span></a>
                                </label>
                                <div class="phase2ta" id="verrouidentifie"  name="verrouidentifie" disabled="<?php echo $bool; ?>" >
                                    <?php	echo $verrouidentifiee;?>
                                </div>
                            </td>
                            <?php } ?>
                        </tr>
                        <tr><td><label id="cptverrou" style="width:450px;color:#B71701;margin-left: 20px;margin-bottom: 10px;display: none "></label></td></tr>
                        <tr style="display: none" id="msgerrverrou">
                            <td>
                                <fieldset class='msgerrverrou' ><legend><?php echo TXT_INFO;?></legend>
                                    <?php 	echo stripslashes(TXT_LIMITEDITEURVERROU).'<br>';?>
                                </fieldset>
                            </td>
                        </tr>
                        
        </table>
 <!----------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------
                                                                                AUTRES CENTRALES    
 ------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------------>                       
 <script>
function afficheetapeautrecentrale(){
    document.getElementById('cptetapeautrecentrale').style.display = 'block';//AAFFICHE COMPTEUR DE CARACTERE DU CHAMPO DESCRIPTION AUTRE CENTRALE
    document.getElementById('etapeautre').style.display = 'block';//AFFICHE LE BLOC ETAPE AUTRE CENTRALE
    document.getElementById('etapeautre1').style.display = 'block';//AFFICHE LE BLOC CHOIX DE LA CENTRALE    
    document.getElementById('affichautrecentrale').value='oui';
}
function masqueetapeautrecentrale(){
    document.getElementById('cptetapeautrecentrale').style.display = 'none';//IDEM QUE DESSUS EN MASQUAGE
    document.getElementById('etapeautre').style.display = 'none';
    document.getElementById('etapeautre1').style.display = 'none';

}                            
</script>
<input type='text' id='affichautrecentrale' style='display: none' value='non'>
<!-- RECUPEREATION DES DONNEES DE LA BASE DE DONNEE-->
                        <fieldset style="padding:10px 15px 15px; border:solid 1px #5D8BA2; margin-right: 20px;margin-top: 15px;width:958px; 
                                          margin-bottom: 15px;margin-left: 20px;color:midnightblue;font-family:verdana;border-radius: 5px;border-radius: 5px 5px 5px 5px;border-color: #5D8BA2;" >
                                <legend><?php echo TXT_AUTRESCENTRALES; ?></legend>
                                <table>
                                    <tr>
                                        <td><!--PERMET AU CHARMEGEMENT DU FORMULAIRE DE VOIR SI ON A UNE AUTRE CENTRALE-->
                                            <label for="etapeautrecentrale" style="width:695px;"><?php echo TXT_ETAPEAUTRECENTRALE.'* :';?></label>
                                            <?php $etapeautrecentrale= $manager->getSingle2("select etapeautrecentrale from projet where idprojet =?",$idprojet);
                                            if ($etapeautrecentrale==TRUE){?>
                                            <input type= "radio" data-dojo-type="dijit/form/RadioButton" name="etapeautrecentrale"   value="TRUE" checked="checked"
                                                        class="btRadio" onclick="afficheetapeautrecentrale()" style="margin-left: 20px;">
                                            <?php echo TXT_OUI; ?>
                                            <input type= "radio" data-dojo-type="dijit/form/RadioButton" name="etapeautrecentrale"  value="FALSE"  class="btRadio"
                                                   onclick="masqueetapeautrecentrale()" style="margin-left: 20px;">
                                            <?php echo TXT_NON; ?>
                                            <?php }else{ ?>
                                            <input type= "radio" data-dojo-type="dijit/form/RadioButton" name="etapeautrecentrale"   value="TRUE"  class="btRadio"
                                                   onclick="afficheetapeautrecentrale()" style="margin-left: 20px;">
                                            <?php echo TXT_OUI; ?>
                                            <input type= "radio" data-dojo-type="dijit/form/RadioButton" name="etapeautrecentrale"  value="FALSE" checked="checked"
                                                   class="btRadio" onclick="masqueetapeautrecentrale()" style="margin-left: 20px;">
                                            <?php echo TXT_NON; ?>
                                            <?php } ?>
                                        </td>
                        <tr>
                            <?php 
                            if ($etapeautrecentrale=='TRUE'){/*ON AFFICHE LA DESCRIPTION DE L'ETAPE*/ ?>
                            <td style="float: left" id="etapeautre1">
                                    <fieldset style="font-size: 1.1em;font-style: italic;width: 520px">
                                        <legend><?php echo TXT_SELECTCENTRALES; ?></legend>
                                    <div id='chckautrecentrale' style="float: left;margin-bottom: 15px;margin-left:20px;margin-top: 10px">
                                        <?php
                                        $icentraleselectionne = $manager->getSingle2("select idcentrale_centrale from concerne where idprojet_projet=?",$idprojet);
                                        $row = $manager->getList2("SELECT libelleCentrale,villeCentrale FROM centrale where libellecentrale != 'Autres' and masquecentrale!=TRUE and idcentrale!= ? order by libelleCentrale asc",$icentraleselectionne);
                                        for ($i = 0; $i < count($row); $i++) {
                                            $libellecentrale = str_replace('-', '',$row[$i][0]);
                                            $villecentrale = $row[$i][1];
                                            ?>
                                            <input  class='opt'  type='checkbox' data-dojo-type='dijit/form/CheckBox' id="<?php echo $libellecentrale;?>" name="autrecentrale[]"  data-dojo-id="<?php echo trim($libellecentrale); ?>" 
                                            value="<?php echo  $libellecentrale ;?>"  >
                                            <label for = "<?php echo  $libellecentrale; ?> " class='opt' id="<?php echo 'lbl'.$libellecentrale;?>" > <?php echo  $row[$i][0] . ' (<i>' . $villecentrale . '</i>)'?> </label>
                                            <br>
                                        <?php }                
                                        ?>                                        
                                        
                                    </div>
                                    </fieldset>
                                </td> 
                                <td  id="etapeautre" style="display:block;float: left">
                                    <?php $descriptionautrecentrale = stripslashes(removeDoubleQuote($descriptionautrecentrale)) ?>
                                    <label for="descriptionautrecentrale" style="width: auto;margin-top:15px">
                                        <?php echo TXT_DESCRIPTETAPE; ?>
                                    </label>
                                    <div id="descriptionautrecentrale"  name="descriptionautrecentrale" disabled="<?php echo $bool; ?>" 
                                         style="margin-right: 0px;color:midnightblue;font-family:verdana;margin-left:0px;width:960px;;margin-bottom: 20px" >
                                    <?php echo $descriptionautrecentrale;?>
                                    </div>
                                </td><!--ON AFFICHE LE CHOIX DES CENTRALES DE L'ETAPE  -->
                                
                        </tr> 
<!-- FIN RECUPERATION DES DONNEES DE LA BASE DE DONNEE-->                                               
                            <?php }else{ ?>
                        <tr> 
                             <td style="float: left;display:none" id="etapeautre1">
                                <fieldset style="font-size: 1.1em;font-style: italic;width: 520px">
                                    <legend><?php echo TXT_SELECTCENTRALES; ?></legend>
                                <div id='chckautrecentrale' style="float: left;margin-bottom: 15px;margin-left:20px;margin-top: 10px">
                                    <?php
                                    $icentraleselectionne = $manager->getSingle2("select idcentrale_centrale from concerne where idprojet_projet=?",$idprojet);
                                    $row = $manager->getList2("SELECT libelleCentrale,villeCentrale FROM centrale where libellecentrale != 'Autres' and masquecentrale!=TRUE and idcentrale!= ? order by libelleCentrale asc",$icentraleselectionne);
                                    for ($i = 0; $i < count($row); $i++) {
                                        $libellecentrale = str_replace('-', '', $row[$i][0]);
                                        $villecentrale = $row[$i][1];?>
                                        
                                        <input  class='opt'  type='checkbox' data-dojo-type='dijit/form/CheckBox' id="<?php echo trim($libellecentrale);?>" data-dojo-id="<?php echo trim($libellecentrale);?>" 
                                                name='autrecentrale[]' value="<?php echo  $libellecentrale;?>"  >
                                        <label for = "<?php echo  $libellecentrale ?>" class='opt' id="<?php echo 'lbl'.$libellecentrale; ?>"> 
                                            <?php echo $row[$i][0] . ' (<i>' . $villecentrale . '</i>)' ?>
                                        </label>
                                        <br>
                                   <?php }?>
                                </div>
                                </fieldset>
                            </td>                            
                            <td  id="etapeautre" style="display:none;float: left">                                
                                <label for="descriptionautrecentrale" style="width: auto;margin-top:15px">
                                    <?php echo TXT_DESCRIPTETAPE; ?>
                                </label>
                                <div id="descriptionautrecentrale"  name="descriptionautrecentrale" disabled="<?php echo $bool; ?>" 
                                     style="margin-right: 0px;color:midnightblue;font-family:verdana;margin-left:0px;width:960px;;margin-bottom: 20px" >
                                <?php echo $descriptionautrecentrale;?></div>
                            </td>
                           
                        </tr>
                        <?php } ?>
                        <tr>
                            <td><label id="cptetapeautrecentrale" style="width:450px;color:#B71701;margin-bottom: 10px;display: none "></label></td>
                        </tr>
                        <tr style="display: none" id="msgerretapeautrecentrale">
                            <td>
                                <fieldset class='msgerrverrou' ><legend><?php echo TXT_INFO;?></legend>
                                    <?php 	echo stripslashes(TXT_LIMITEDITEURVERROU).'<br>';?>
                                </fieldset>
                            </td>                            
                        </tr>                              
                        </table>                                
                    </fieldset>
                                                                 
                        <table style="margin-bottom: 15px">
                            <tr>
                                <td>
                                    <label for="nbPlaque" style="width: auto;margin-left: 20px;"><?php echo TXT_NBPLAQUE.':'; ?></label>
                                    <?php 
                                    $Disabled =str_replace("''","",$disabled);
                                    if(!empty($Disabled)){?>
                                    <input type="text" id="nbPlaque"  name="nbPlaque" value="<?php echo $nbplaque;?>"
                                           data-dojo-type="dijit/form/NumberTextBox"  data-dojo-invalidMessage="valeur non valide."
                                           style="margin-left: 20px;width:160px" autocomplete="on" <?php echo $disabled; ?> >
                                           &nbsp;<?php echo TXT_OU; ?>&nbsp;
                                    <?php }else{?>
                                    <input type="text" id="nbPlaque"  name="nbPlaque" value="<?php echo $nbplaque;?>"
                                           data-dojo-type="dijit/form/NumberTextBox"  data-dojo-invalidMessage="valeur non valide."
                                           style="margin-left: 20px;width:160px" autocomplete="on"  >
                                           &nbsp;<?php echo TXT_OU; ?>&nbsp;
                                    <?php }?>
                                </td>
                                <td>
                                    <label for="nbRun" style="width: auto;margin-left: 20px;" ><?php echo TXT_NBRUN.' :';?>
                                    </label>
                                    <?php if(!empty($Disabled)){?>
                                    <input id="nbRun" type="text" name="nbRun" value="<?php echo $nbrun; ?>" data-dojo-type="dijit/form/NumberTextBox"
                                           style="width: 160px;margin-left: 20px;"  data-dojo-invalidMessage="valeur non valide." autocomplete="on"
                                           <?php echo $disabled; ?> 
                                        >
                                    <?php }else{?>
                                    <input id="nbRun" type="text" name="nbRun" value="<?php echo $nbrun; ?>" data-dojo-type="dijit/form/NumberTextBox"
                                    style="width: 160px;margin-left: 20px;"  data-dojo-invalidMessage="valeur non valide." autocomplete="on">                                    
                                    <?php }?>                                           
                                </td>                            
                        </table><input id="reponsedevis" value='' style="display: none" >
                        <table style="margin-bottom: 15px">
                            <tr>
                                <td>
                                    <label for="devis" style="width: auto;margin-left: 20px;"><?php echo TXT_ENVOIDEVIS.'* ?';?></label>
                                    <?php
                                    $devis = $manager->getSingle2("select envoidevis from projet where idprojet = ?",$idprojet);
                                    if ($devis==TRUE){?>
                                    <input type= "radio" data-dojo-type="dijit/form/RadioButton" name="devis"  checked="checked" value="TRUE"
                                           class="btRadio" style="margin-left: 20px;" disabled="<?php echo $bool; ?>"
                                           onclick="disabledevis('/<?php echo REPERTOIRE;?>/outils/disabledevis.php?lang=<?php echo $lang;?>&devis=' + this.value + '')">
                                    <?php echo TXT_OUI; ?>
                                    <input type= "radio" data-dojo-type="dijit/form/RadioButton" name="devis"  value="FALSE"  class="btRadio"
                                           onclick="disabledevis('/<?php echo REPERTOIRE;?>/outils/disabledevis.php?lang=<?php echo $lang;?>&devis=' + this.value + '')"
                                           style="margin-left: 20px;" disabled="<?php echo $bool; ?>" >
                                    <?php echo TXT_NON; ?>
                                    <?php }else{ ?>
                                    <input type= "radio" data-dojo-type="dijit/form/RadioButton" name="devis"   value="TRUE" class="btRadio"
                                           onclick="disabledevis('/<?php echo REPERTOIRE;?>/outils/disabledevis.php?lang=<?php echo $lang;?>&devis=' + this.value + '')"
                                           style="margin-left: 20px;"
                                           disabled="<?php echo $bool; ?>" > <?php echo TXT_OUI; ?>
                                    <input type= "radio" data-dojo-type="dijit/form/RadioButton" name="devis" checked="checked" value="FALSE"
                                           class="btRadio"  style="margin-left: 20px;"
                                           onclick="disabledevis('/<?php echo REPERTOIRE;?>/outils/disabledevis.php?lang=<?php echo $lang;?>&devis=' + this.value + '')">
                                    <?php echo TXT_NON; ?>
                                    <?php } ?>
                                </td>
                                <?php  if ($devis==TRUE){?>

                                <td id="mailResp" style="display: block">
                                    <label for="mailresp" style="margin-left: 20px;width: auto" ><?php echo TXT_EMAILRESPDEVIS;?></label>
                                    <input id="mailresp" type="text" name="mailresp"
                                           value="<?php if(!empty($emailrespdevis)){echo $emailrespdevis;} ?>"
                                           class="long" data-dojo-type="dijit/form/ValidationTextBox"
                                           regExpGen="dojox.validate.regexp.emailAddress"      style="margin-left: 20px;"
                                           invalidMessage="<?php echo TXT_EMAILNONVALIDE; ?>" autocomplete="on"
                                           placeHolder ="<?php echo TXT_EMAIL; ?>"
                                           disabled="<?php echo $bool; ?>" />
                                </td>
                                <?php }else{ ?>
                                <td id="mailResp" style="display:  none">
                                    <label for="mailresp" style="margin-left: 20px;width: 300px" ><?php echo TXT_EMAILRESPDEVIS;?></label>
                                    <input id="mailresp" type="text" name="mailresp" class="long" data-dojo-type="dijit/form/ValidationTextBox"
                                           regExpGen="dojox.validate.regexp.emailAddress"      style="margin-left: 20px;"
                                           invalidMessage="<?php echo TXT_EMAILNONVALIDE; ?>" autocomplete="on"
                                           placeHolder ="<?php echo TXT_EMAIL; ?>"
                                           disabled="<?php echo $bool; ?>" />
                                </td>
                                <?php } ?>
                            </tr>
                        </table>
                        <table>
                            <tr>
                                <td>
                                    <label for="reussite" style="width: 1011px;margin-left: 20px"><?php echo TXT_REUSSITEESCOMPTE.' :'; ?>
                                        <a class="infoBulle" href="#"><img src='<?php echo "/".REPERTOIRE; ?>/styles/img/help.gif' height="13px" width="13px"/>
                                            <span style="text-align: left;padding:10px;width: 600px;border-radius:5px" >
                                                <?php echo affiche('TXT_AIDEREUSSITEESCOMPTE');?></span></a>
                                    </label>
                                    <div class="phase2ta" id="reussite" name="reussite"	disabled="<?php echo $bool; ?>" style="margin-left: 20px">
                                        <?php echo $reussite; ?>
                                    </div>
                                </td>
                            </tr>
                            <tr><td><label id="cptreussite" style="width:450px;color:#B71701;margin-left: 20px;margin-bottom: 10px; "></label></td></tr>
                            <tr style="display: none" id="msgerrreussite">
                                <td>
                                    <fieldset class='msgerrreussite' ><legend><?php echo TXT_INFO;?></legend>
                                        <?php 	echo stripslashes(TXT_LIMITEDITEURREUSSITE).'<br>';?>
                                    </fieldset>
                                </td>
                            </tr>
                        </table>
                        <table>                            
                            <tr>
                                <?php 
                                $idtypeuser= $manager->getSingle2("SELECT idtypeutilisateur_typeutilisateur FROM loginpassword,utilisateur WHERE  idlogin = idlogin_loginpassword and pseudo =?",$_SESSION['pseudo']);
                                $idutilisateur = $manager->getSingle2("select idutilisateur from utilisateur,loginpassword where idlogin=idlogin_loginpassword and pseudo=?",$_SESSION['pseudo']);
                                $dateadminprojet=$manager->getSinglebyArray("select dateaffectation from utilisateuradministrateur where idprojet=? and idutilisateur=?",array($idprojet,$idutilisateur));
                                if(!empty($dateadminprojet)){
                                    $adminprojet=1;
                                }else{
                                   $adminprojet=0;
                                }
                                if($idtypeuser!=6 || $adminprojet==1){ ?>
                                <td>
                                    <label for="refinterne" style="width: 260px;margin-left: 20px;" ><?php echo TXT_REFINTERNE.':';?></label>
                                    <?php $refinterneprojet =trim(stripslashes(str_replace("''",	"'",
                                    $refinterneprojet))) ?>
                                    <input id="refinterne" type="text" name="refinterne"	value="<?php echo $refinterneprojet; ?>"
                                           data-dojo-type="dijit/form/ValidationTextBox" autocomplete="on"   style="margin-left: 20px;margin-bottom: 15px"
                                           disabled="<?php echo $bool; ?>" 	data-dojo-invalidMessage="<?php echo TXT_ERRSTRING ;?>"
                                           data-dojo-props="<?php echo REGEX_TYPE; ?>" maxlength="100" >
                                </td>                                
                                <?php }else{?>
                                <td>
                                    <label for="refinterne" style="width: 260px;margin-left: 20px;" ><?php echo TXT_REFINTERNE.':';?></label>
                                    <?php $refinterneprojet =trim(stripslashes(str_replace("''",	"'",	$refinterneprojet))) ?>
                                    <input id="refinterne" type="text" name="refinterne"	value="<?php echo $refinterneprojet; ?>"
                                           data-dojo-type="dijit/form/ValidationTextBox" autocomplete="on"
                                           style="margin-left: 20px;" disabled="disabled"   maxlength="100"  >
                                </td>
                                <?php }?>
                            </tr>                            
                        </table>
        </fieldset><input type='text' name='maj' id='maj' style='display:none' value='non'>
                   <input type='text' name='majcentrale' id='majcentrale' style='display:none' value='non'>
                        <?php 
                            $etapeautrecentrale = $manager->getSingle2("select etapeautrecentrale from projet where idprojet=?",$idprojet); 
                            if(!empty($etapeautrecentrale)){
                                $etapeautrecentrale='TRUE';
                            }
                            $idtypeutilisateur = $manager->getSingle2('select idtypeutilisateur_typeutilisateur from utilisateur,loginpassword where idlogin_loginpassword=idlogin and pseudo=?',$_SESSION['pseudo']);
                            $pseudo =  $manager->getSingle2('SELECT pseudo FROM loginpassword,projet,creer,utilisateur WHERE idutilisateur_utilisateur = idutilisateur AND idprojet_projet = idprojet 
                            AND idlogin_loginpassword = idlogin AND idprojet=?',$idprojet);
                            $pseudoAdministrateur =$manager->getList2('SELECT l.pseudo FROM loginpassword l,projet p,utilisateur u,utilisateuradministrateur ua WHERE u.idlogin_loginpassword = l.idlogin 
                            AND ua.idprojet = p.idprojet AND ua.idutilisateur = u.idutilisateur AND  p.idprojet=?',$idprojet);                            
                            $pseudoPorteur = $manager->getList2('SELECT pseudo FROM loginpassword,projet,utilisateur,utilisateurporteurprojet WHERE idlogin_loginpassword = idlogin 
                            AND idutilisateur = idutilisateur_utilisateur AND idprojet_projet = idprojet AND idprojet=?',$idprojet);
                            
                            
                            $admin=array();
                            for ($i=0;$i<count($pseudoAdministrateur);$i++){
                                array_push($admin,$pseudoAdministrateur[$i]['pseudo']);
                            }
                            $porteur=array();
                            for ($i=0;$i<count($pseudoPorteur);$i++){
                                array_push($porteur,$pseudoPorteur[$i]['pseudo']);
                            }                           
                            ?>     
                            
                <?php if($_SESSION['pseudo'] == $pseudo || in_array($_SESSION['pseudo'],$admin) ||$_SESSION['pseudo'] == $pseudoPorteur ||  $idtypeutilisateur == ADMINLOCAL) {?>            
                <table>                     
                    <tr>
                        <td>
                            <div style='float: left'>                   
                                <?php  if($idstatut==ENATTENTEPHASE2){?>                            
                                <input type="button"  label="<?php echo TXT_VALIDERENVOYER ;?>" data-dojo-type="dijit/form/Button" 
                                       data-dojo-props="
                                        onClick:function(){
                                            if(dijit.byId('modifProjet').validate()){
                                                rep.show();
                                            }
                                        }" style="margin-top:15px">
                                <a class="infoBulle" href="#" style='margin-bottom: 20px;'><img src='<?php echo "/".REPERTOIRE; ?>/styles/img/help.gif' height="13px" width="13px"/>
                                    <span style="text-align: left;padding:7px;width: 430px;border-radius:5px" ><?php echo TXT_VALIDETRANSMISSION;?></span>
                                </a>
                                 <?php  }else{
                                        $etapeautrecentrale= $manager->getSingle2("select etapeautrecentrale from projet where idprojet =?",$idprojet);
                                        $sendmail = $manager->getSingle2("select sendmail from projetautrecentrale where idprojet =?",$idprojet);                                        
                                        if ($etapeautrecentrale==TRUE && $sendmail==TRUE){?>
                                        <button data-dojo-type="dijit/form/Button" type="button" disabled="<?php echo $bool; ?>" style="margin-top:15px" id='btnMajEnvoye' 
                                        data-dojo-props="
                                            onClick:function(){
                                                if(dijit.byId('modifProjet').validate()){
                                                    repautrecentrale.show();
                                                }
                                            }"><?php echo TXT_MAJENVOYER ;?>
                                        </button>
                                 <a class="infoBulle" href="#" style='margin-bottom: 20px;'><img src='<?php echo "/".REPERTOIRE; ?>/styles/img/help.gif' height="13px" width="13px"/>
                                    <span style="text-align: left;padding:10px;width: 300px;border-radius:5px"><?php echo TXT_MAJTRANSMISSION;?></span>
                                </a>
                                        
                                        <?php }else{?>
                                <button data-dojo-type="dijit/form/Button"  type="button" data-dojo-props="onClick:function(){if(dijit.byId('modifProjet').validate()){rep2.show();}}" id='btnMajEnvoye' disabled="<?php echo $bool; ?>" 
                                           style="margin-top:15px"  ><?php echo TXT_MAJENVOYER ;?></button>
                                 <a class="infoBulle" href="#" style='margin-bottom: 20px;'><img src='<?php echo "/".REPERTOIRE; ?>/styles/img/help.gif' height="13px" width="13px"/>
                                    <span style="text-align: left;padding:10px;width: 300px;border-radius:5px"><?php echo TXT_MAJTRANSMISSION;?></span>
                                </a>
                                <?php }?>
                                  <?php }?>
                            </div>                        
                            </td>
                    </tr>
                </table>
                <table>            
                    <tr>
                        <td id='btnSave'>
                            <button data-dojo-type="dijit/form/Button" id='btnsave' type="button" data-dojo-props="onClick:function(){if(dijit.byId('modifProjet').validate()){save();}}"  disabled="<?php echo $bool; ?>" 
                                    style="margin-top:15px"><?php echo TXT_SAVEPROJECT ;?></button>
                        </td>
                        <td id="infoSave"><?php echo TXT_SAVEDATA;?></td>                        
                    </tr>
                    <tr><td><div style="margin-top: 5px"></div></td></tr>
                </table>
                <?php }?>
        <div data-dojo-type="dijit/Dialog" data-dojo-id='rep' title="<?php echo TXT_RESULTMESSAGECONFIRMPHASE;?>" style="width: 500px;margin-left: 20px;" execute="">
           <table class="dijitDialogPaneContentArea">
               <tr>
                   <td><button type="submit" data-dojo-type="dijit/form/Button"  id="oui"  data-dojo-props="onClick:function(){valide();}">
                           <?php echo TXT_OUI ;?></button></td>                           
                   <td><button data-dojo-type="dijit/form/Button" type="button" data-dojo-props="onClick:function(){rep.hide();}" id="submitcancel"><?php echo TXT_ANNULE;?></button></td>
               </tr>
           </table>
       </div>
        <div data-dojo-type="dijit/Dialog" data-dojo-id="rep2" title="<?php echo TXT_RESULTMESSAGECONFIRMPHASE;?>" style="width: 500px;margin-left: 20px;   ">
           <table class="dijitDialogPaneContentArea">
               <tr>
                   <td><button type="submit" data-dojo-type="dijit/form/Button"  id="oui2"  data-dojo-props="onClick:function(){maj();}"><?php echo TXT_OUI ;?></button></td><td>
                   <td><button data-dojo-type="dijit/form/Button" type="submit" data-dojo-props="onClick:function(){rep2.hide();}" id="submitCancel2"><?php echo TXT_ANNULE;?></button></td>
               </tr>
           </table>
        </div>                                                                       <!---  Vous avez déja envoyer un email aux autres centrales, est ce que vous souhaiter les informer des modifications du projet?-->
        <div data-dojo-type="dijit/Dialog" data-dojo-id="repautrecentrale" title="<?php echo TXT_RESULTMESSAGECONFIRMAUTRECENTRALE;?>" style="width: 500px;margin-left: 20px;   ">
          <table class="dijitDialogPaneContentArea">
              <tr>
                  <td><button type="submit" data-dojo-type="dijit/form/Button"  id="yes2" onclick="majcentrale()"><?php echo TXT_OUI ;?></button></td><td>
                  <td><button type="submit" data-dojo-type="dijit/form/Button"  id="no2"  data-dojo-props="onClick:function(){maj();}"><?php echo TXT_NON ;?></button></td>                               
                  <td><button data-dojo-type="dijit/form/Button" type="submit" data-dojo-props="onClick:function(){rep2.hide();}" id="submitCancel3"><?php echo TXT_ANNULE;?></button></td>
              </tr>
          </table>
      </div><script>            
          function valide(){
                document.getElementById('save').value='non';
                document.getElementById('maj').value = 'non';
                modifProjet.submit();
            }
        
            function maj(){
                document.getElementById('save').value='non';
                document.getElementById('maj').value = 'oui';
                document.getElementById('majcentrale').value = 'non';
                modifProjet.submit();
            }
            function majcentrale(){
                document.getElementById('save').value='non';
                document.getElementById('maj').value = 'oui';
                document.getElementById('majcentrale').value = 'oui';
                modifProjet.submit();
            }
            function save() {
                document.getElementById('save').value='oui';
                document.getElementById('maj').value = 'non';
                document.getElementById('majcentrale').value = 'non';
                modifProjet.submit();
            }

        </script>
     <input type='text' value='non' name='save' id='save' style='display:none'>
 <?php if ($_SESSION['idTypeUser']==ADMINLOCAL || in_array($_SESSION['pseudo'],$admin)){;?>    
<?php
if(!empty($_GET['statut'])){
    $idstatutencours=$_GET['statut'];
}else{
    $idstatutencours = $manager->getSingle2("SELECT  idstatutprojet_statutprojet FROM concerne,projet WHERE idprojet_projet = idprojet and idprojet = ?",$idprojet);
}
$idstatut=(int)$idstatutencours;
if($idstatut!=ENATTENTEPHASE2){
    if($idtypeutilisateur==ADMINNATIONNAL || $idtypeutilisateur==ADMINLOCAL || $adminprojet==1){?>
    <!-----------------------------------------------------------------------------------------------------------------------------------
                                GESTION DU STATUT DU PROJET
    //----------------------------------------------------------------------------------------------------------------------------------->
    <table>

    <tr>
        <td style="width:250px">
            <div style="float:left">
        <label for="statutProjet" style="width: 200px;margin-top:12px;margin-left:5px"><?php echo TXT_STATUTPROJET.'* :'; ?> </label>
    <?php

    $param=array(ENATTENTEPHASE2,$idstatut,ENATTENTEPHASE2);
    $rowstatut = $manager->getListbyArray("select idstatutprojet,libellestatutprojet,libellestatutprojeten from statutprojet where idstatutprojet !=? and idstatutprojet!=? 
    and idstatutprojet!=?  order by idstatutprojet asc",$param);    
    $value='st'.$idstatutencours;

    ?>
    <input type='text' name='chgstatut' id='chgstatut' value='non' style='display:none'>    
    <script>    
    function choice(value){        
    if(value ==='st<?php echo ENCOURSREALISATION; ?>'|| value ==='st<?php echo FINI; ?>'||value ==='st<?php echo CLOTURE ?>' ){
            document.getElementById('modifdatestatut').style.display='block';
            document.getElementById('validestatut').style.display='none';
            document.getElementById('chgstatut').value='oui';
            document.getElementById('central').style.display='none';
            dijit.byId("btnMajEnvoye").setAttribute('disabled', true);
            dijit.byId("btnsave").setAttribute('disabled', true);
            
        }else if(value ==='st<?php echo ACCEPTE; ?>'){
            document.getElementById('modifdatestatut').style.display='none';
            document.getElementById('validestatut').style.display='block';
            document.getElementById('central').style.display='none';
            document.getElementById('chgstatut').value='oui';
            dijit.byId("btnMajEnvoye").setAttribute('disabled', false);
            dijit.byId("btnsave").setAttribute('disabled', false);
            
        }else if(value ==='st<?php echo REFUSE; ?>'){
            document.getElementById('modifdatestatut').style.display='none';
            document.getElementById('validestatut').style.display='block';
            document.getElementById('commentphase2').style.display='block';
            document.getElementById('central').style.display='none';
            document.getElementById('chgstatut').value='oui';
            dijit.byId("btnMajEnvoye").setAttribute('disabled', false);
            dijit.byId("btnsave").setAttribute('disabled', false);
            
        }else if(value ==='st<?php echo TRANSFERERCENTRALE; ?>'){
            document.getElementById('modifdatestatut').style.display='none';
            document.getElementById('validestatut').style.display='block';
            document.getElementById('commentphase2').style.display='none';
            document.getElementById('central').style.display='block';
            document.getElementById('chgstatut').value='oui';            
            dijit.byId("btnMajEnvoye").setAttribute('disabled', false);
            dijit.byId("btnsave").setAttribute('disabled', false);
            
        }else{
            document.getElementById('modifdatestatut').style.display='none';
            document.getElementById('commentphase2').style.display='none';
            document.getElementById('validestatut').style.display='none';
            document.getElementById('central').style.display='none';
            dijit.byId("btnMajEnvoye").setAttribute('disabled', false);
            dijit.byId("btnsave").setAttribute('disabled', false);            
        }
    }
    
    </script>
    <select name="statutProjet" id="statutProjet" data-dojo-type="dijit/form/FilteringSelect" style="width: 220px;margin-left: 5px" 
            disabled="<?php echo $bool; ?>" data-dojo-props="value:'<?php echo $value; ?>',onChange: function(value){choice(value);}" >
    <?php       
        if($idstatutencours>0){
            $arraystatutencours = $manager->getList2("select libellestatutprojet,libellestatutprojeten from statutprojet where idstatutprojet =?",$idstatutencours);
            if($lang=='fr'){?>
               <option value="<?php echo 'st'.$idstatutencours;?>" ><?php echo removeDoubleQuote($arraystatutencours[0]['libellestatutprojet']) ?></option>
            <?php }elseif($lang=='en'){?>
               <option value="<?php echo 'st'.$idstatutencours;?>" ><?php echo removeDoubleQuote($arraystatutencours[0]['libellestatutprojeten']) ?></option>
            <?php
                }
        }else{
            echo TXT_CHOIXSTATUTPROJET;
        }
        $nbrowstatut =count($rowstatut);
        if($lang=='fr'){
            for ($i = 0;$i < $nbrowstatut;$i++) {?>                
                <option value="<?php echo 'st'.$rowstatut[$i]['idstatutprojet'];?>" ><?php echo removeDoubleQuote($rowstatut[$i]['libellestatutprojet']) ?></option>
    <?php   }
        }elseif($lang=='en'){
            for ($i = 0;$i < $nbrowstatut;$i++) {?>
                <option value="<?php echo 'st'.$rowstatut[$i]['idstatutprojet'];?>" ><?php echo removeDoubleQuote($rowstatut[$i]['libellestatutprojeten']) ?></option>
      <?php }
        }
    ?>
    </select>
            </div>
    </td>
    <td id="central" style="display: none">
                    <label for="centraletrs" style="width: auto;margin-top: 16px"><?php echo TXT_CENTRALE.'* :'; ?> </label>
                    <?php                     
                    $libellecentrale = $manager->getList("select idcentrale,libellecentrale from centrale where libellecentrale!='Autres' and
                    idcentrale!=$idcentraleconnecte order by libellecentrale asc"); ?>
                    <select id="centraletrs" name="centraletrs" data-dojo-type="dijit/form/Select" style="width: 220px;margin-left: 5px"
                            data-dojo-props="  value: '' , placeHolder: '<?php echo TXT_SELECTCENTRALE;?>',
                            onChange: function(value){
                                if(value!='0'){
                                    document.getElementById('chgstatut').value='oui';
                                }
                            }
                            " >
                        <?php
                        echo "<option value='0'>".TXT_SELECTCENTRALE."</option>";
                        for ($i = 0;$i < count($libellecentrale);$i++) {
                        echo "<option value='".$libellecentrale[$i]['idcentrale']."'>".str_replace("''","'",$libellecentrale[$i]['libellecentrale'])."
                        </option>";
                        }?>
                    </select>
    </td>    
        <td id="modifdatestatut" style="display: none;">
            <label for="datemodifstatut" style="width: 260px;margin-top: 16px">
                <?php echo TXT_DATECANGEMENTSTATUT; ?></label>
            <input type="text" name="datemodifstatut" id="datemodifstatut" value="<?php echo date('Y-m-d');?>" data-dojo-type="dijit/form/DateTextBox"  autocomplete="on" >

                <input data-dojo-type="dijit/form/Button"  type="button"  label="<?php echo TXT_VALIDER ;?>" data-dojo-type="dijit/form/Button" disabled="<?php echo $bool; ?>" 
                       data-dojo-props="onClick:function(){if(dijit.byId('modifProjet').validate()){repstatut0.show();}}" >
        </td>
    </tr>
    <?php  
        $etapeautrecentrale= $manager->getSingle2("select etapeautrecentrale from projet where idprojet =?",$idprojet); 
        $sendmail = $manager->getSingle2("select sendmail from projetautrecentrale where idprojet =?",$idprojet);
    ?>
    <tr>
        <td id="validestatut" style="display: none;margin-top: 32px;">
            <input type="submit"  label="<?php echo TXT_VALIDER ;?>" data-dojo-type="dijit/form/Button" disabled="<?php echo $bool; ?>" >
        </td>
    </tr>
    </table>
    <div data-dojo-type="dijit/Dialog" data-dojo-id="repstatut0" title="<?php echo 'Souhaitez-vous envoyer les emails correspondants au changement de statut?';?>" style="width: 500px;margin-left: 20px;   ">
          <table class="dijitDialogPaneContentArea">
              <tr>
                <?php if ($etapeautrecentrale==TRUE && $sendmail==TRUE){?>
                  <td><button type="submit" data-dojo-type="dijit/form/Button"  id="yes4" data-dojo-props="onClick:function(){repstatut.show();}"><?php echo TXT_OUI ;?></button></td><td>
                <?php }else{?>
                    <td><button type="submit" data-dojo-type="dijit/form/Button"  id="yes4" data-dojo-props="onClick:function(){repStatut();}"><?php echo TXT_OUI ;?></button></td><td>
                <?php }?>                        
                  <td><button type="submit" data-dojo-type="dijit/form/Button"  id="no4"  data-dojo-props="onClick:function(){repStatutNon0();}"><?php echo TXT_NON ;?></button></td>                               
                  <td><button data-dojo-type="dijit/form/Button" type="submit" data-dojo-props="onClick:function(){repstatut0.hide();}" id="submitCancel4"><?php echo TXT_ANNULE;?></button></td>
              </tr>
          </table>
      </div> 
<?php 
    if ($etapeautrecentrale==TRUE && $sendmail==TRUE){?>
     <div data-dojo-type="dijit/Dialog" data-dojo-id="repstatut" title="<?php echo TXT_RESULTMESSAGECONFIRMAUTRECENTRALE;?>" style="width: 500px;margin-left: 20px;   ">
          <table class="dijitDialogPaneContentArea">
              <tr>
                  <td><button type="submit" data-dojo-type="dijit/form/Button"  id="yes3" data-dojo-props="onClick:function(){repStatut();}"><?php echo TXT_OUI ;?></button></td><td>
                  <td><button type="submit" data-dojo-type="dijit/form/Button"  id="no3"  data-dojo-props="onClick:function(){repStatutNon();}"><?php echo TXT_NON ;?></button></td>                               
                  <td><button data-dojo-type="dijit/form/Button" type="submit" data-dojo-props="onClick:function(){repstatut.hide();}" id="submitCancel5"><?php echo TXT_ANNULE;?></button></td>
              </tr>
          </table>
      </div>
    <?php } ?>
    <script>
        function repStatut(){
            document.getElementById('save').value='non';
            document.getElementById('maj').value = 'non';   
            //document.getElementById('majcentrale').value = 'oui';
            document.getElementById('emailNon').value='oui';
            modifProjet.submit();
        }
        function repStatutNon(){
            document.getElementById('save').value='non';
            document.getElementById('maj').value = 'non';   
            //document.getElementById('majcentrale').value = 'non';
            document.getElementById('emailNon').value='oui';
            modifProjet.submit();
        }
        function repStatutNon0(){
            document.getElementById('emailNon').value='non';
            modifProjet.submit();
        }
    </script>
                                
<?php } ?>                                   
<?php }?>
<!-----------------------------------------------------------------------------------------------------------------------------------
                COMMENTAIRE
-------------------------------------------------------------------------------------------------------------------------------------->
<input type='text' value='oui' name='emailNon' id='emailNon' style='display:none'>
<table style="display: none" id="commentphase2">
<tr>
    <td>
        <label for="commentairephase2" style="width:450px;margin-top: 20px;margin-bottom: 10px; "> <?php echo TXT_COMMENTAIREPROJET.' :'; ?> 
            <a class="infoBulle" href="#"><img src='<?php echo "/".REPERTOIRE; ?>/styles/img/help.gif' height="13px" width="13px"/>
                <span style="text-align: left;padding:10px;width: 470px;border-radius:5px" ><?php echo affiche('TXT_AIDECOMMENTAIREPROJET');?>
                </span>
            </a>
        </label>
        <div  id="commentairephase2" name="commentairephase2" style="width:988px;" height="100px" ></div>
    </td>
</tr>   
</table>                        
<?php }?>
<input type="hidden" id="desTechno" name="desTechno" >
<input type="hidden" id="verrouide" name="verrouide" >
<input type="hidden" id="reussit" name="reussit" >
<input type="hidden" id="etautrecentrale" name="etautrecentrale" >
<input type="hidden" id="commentairephase2Valeur" name="commentairephase2Valeur" >

<input type="hidden" id="rb_oui" name="rb_oui" >

<p class='champobligatoire'><?php echo TXT_CHAMPSOBLIGATOIRES; ?></p>
</fieldset>

                        <?php $typeformation = $manager->getSingle2("SELECT libelletype FROM  projet,typeprojet WHERE idtypeprojet = idtypeprojet_typeprojet and idprojet = ?",$idprojet);?>
                        <script>
                            require(["dojo/parser", "dijit/Editor"]);
                            require(["dojo"], function(dojo) {
                            });
                            require(["dijit/Editor", "dojo/ready"], function(Editor, ready) {
                                ready(function() {
                                    new Editor({
                                        plugins: ["undo", "redo"],height: "100px",disabled: "", display: 'none'
                                    }, "commentairephase2");
                                    new Editor({
                                        plugins: ["undo", "redo"],
                                        height: "150px", disabled: '<?php echo $bool1;?>'
                                    }, "descriptifTechnologique");
                                    new Editor({
                                        plugins: ["undo", "redo"],
                                        height: "150px", disabled: '<?php echo $bool1;?>'
                                    }, "verrouidentifie");
                                    new Editor({
                                        plugins: ["undo", "redo"],
                                        height: "150px", disabled: '<?php echo $bool1;?>'
                                    }, "reussite");
                                    new Editor({
                                        plugins: ["undo", "redo", "|"],
                                        height: "150px", disabled: '<?php echo $bool1;?>'
                                    }, "descriptionautrecentrale");
                                    
                                });

                                function modiProjetPhase2OnSubmit() {}
                                dojo.addOnLoad(function() {                                 
                                    var editor1 = dijit.byId("descriptifTechnologique");
                                    var editor2 = dijit.byId("verrouidentifie");
                                    var editor3 = dijit.byId("reussite");
                                    var editor4 = dijit.byId("commentairephase2");
                                    var editor5 = dijit.byId("descriptionautrecentrale");
                                    var editor6 = dijit.byId("descriptioncentraleproximite");
                                    var formElements = dojo.query("input:checked");
                                    var editor10 = formElements[0].value;                 
                                    document.getElementById('rb_oui').value=editor10;                                    
                                    var nbpartenaire = +'<?php echo $nbpartenaire;?>';//IDEM POUR LES PARTENAIRES
                                    addnom(nbpartenaire);
                                    var nbpersonne = +'<?php echo $nbpersonne;?>';
                                    addnomCentrale(nbpersonne);
                                    var typeformation = '<?php echo $typeformation; ?>';
                                    if (typeformation === 'Formation') {
                                        document.getElementById('grpTypeFormation').style.display = 'block';
                                        document.getElementById('blocnbHeureEleve').style.display = 'block';
                                    } else {
                                        document.getElementById('grpTypeFormation').style.display = 'none';
                                        document.getElementById('blocnbHeureEleve').style.display = 'none';
                                    }
                                    dojo.connect(dojo.byId("phase2"), "onsubmit", modiProjetPhase2OnSubmit);
                                    dojo.connect(editor1, "onChange", this, function(event) {
                                        dojo.byId("desTechno").value = editor1.get("value");
                                    });
                                    dojo.connect(editor2, "onChange", this, function(event) {
                                        dojo.byId("verrouide").value = editor2.get("value");
                                    });
                                    dojo.connect(editor3, "onChange", this, function(event) {
                                        dojo.byId("reussit").value = editor3.get("value");
                                    });
                                    dojo.connect(editor4, "onChange", this, function() {
                                        dojo.byId("commentairephase2Valeur").value = editor4.get("value");
                                    });
                                    dojo.connect(editor5, "onChange", this, function() {
                                        dojo.byId("etautrecentrale").value = editor5.get("value");
                                    });
                                     dojo.connect(editor6, "onChange", this, function() {
                                     //CAS POUR CHROME etautrecentrale
                                    dojo.byId("desTechno").value = editor1.get("value");
                                        document.getElementById('cptdescriptechno').innerHTML = "<?php echo TXT_NBCARACT.' : '; ?>"+ strip_tags(trim(dojo.byId("desTechno").value),'').length; 
                                        dojo.byId("verrouide").value = editor2.get("value");
                                        document.getElementById('cptverrou').innerHTML = "<?php echo TXT_NBCARACT.' : '; ?>"+ strip_tags(trim(dojo.byId("verrouide").value),'').length;
                                        dojo.byId("reussit").value = editor3.get("value");
                                        document.getElementById('cptreussite').innerHTML = "<?php echo TXT_NBCARACT.' : '; ?>"+ strip_tags(trim(dojo.byId("reussit").value),'').length;
                                        dojo.byId("etautrecentrale").value = editor5.get("value");
                                        document.getElementById('cptetapeautrecentrale').innerHTML = "<?php echo TXT_NBCARACT.' : '; ?>"+ strip_tags(trim(dojo.byId("etautrecentrale").value),'').length; 
                                     });
//----------------------------------------------------------------------------------------------------------------------------------------------------
//                                                                              DESCIPTIF TECHNOLOGIQUE
//----------------------------------------------------------------------------------------------------------------------------------------------------
                                    dojo.connect(editor1, "onKeyPress", this, function(event) {
                                        dojo.byId("desTechno").value = editor1.get("value");
                                        document.getElementById('cptdescriptechno').innerHTML = "<?php echo TXT_NBCARACT.' : '; ?>"+ strip_tags(trim(dojo.byId("desTechno").value),'').length;
                                        if (trim(strip_tags(editor1.get("value")),'').length > 3000) {
                                            document.getElementById('msgerrdescriptechno').style.display = 'block';
                                        } else {
                                            document.getElementById('msgerrdescriptechno').style.display = 'none';
                                        }
                                    });
                                    dojo.connect(editor1, "onClick", this, function(event) {
                                        dojo.byId("desTechno").value = editor1.get("value");
                                        document.getElementById('cptdescriptechno').innerHTML = "<?php echo TXT_NBCARACT.' : '; ?>"+ strip_tags(trim(dojo.byId("desTechno").value),'').length;
                                        if (trim(strip_tags(editor1.get("value")),'').length > 3000) {
                                            document.getElementById('msgerrdescriptechno').style.display = 'block';
                                        } else {
                                            document.getElementById('msgerrdescriptechno').style.display = 'none';
                                        }
                                    });
                                    dojo.connect(editor1, "onBlur", this, function(event) {
                                        dojo.byId("desTechno").value = editor1.get("value");
                                        document.getElementById('cptdescriptechno').innerHTML = "<?php echo TXT_NBCARACT.' : '; ?>" + strip_tags(trim(dojo.byId("desTechno").value),'').length;
                                        if (trim(strip_tags(editor1.get("value")),'').length > 3000) {
                                            document.getElementById('msgerrdescriptechno').style.display = 'block';
                                        } else {
                                            document.getElementById('msgerrdescriptechno').style.display = 'none';
                                        }
                                    });
                                    dojo.connect(editor1, "onLoad", this, function(event) {
                                        dojo.byId("desTechno").value = editor1.get("value");
                                        document.getElementById('cptdescriptechno').innerHTML = "<?php echo TXT_NBCARACT.' : '; ?>"+ strip_tags(trim(dojo.byId("desTechno").value),'').length;              
                                    });	
            
//----------------------------------------------------------------------------------------------------------------------------------------------------
//                                                                              VERROU 
//----------------------------------------------------------------------------------------------------------------------------------------------------
                                    dojo.connect(editor2, "onKeyPress", this, function(event) {
                                        dojo.byId("verrouide").value = editor2.get("value");
                                        document.getElementById('cptverrou').innerHTML = "<?php echo TXT_NBCARACT.' : '; ?>"+ strip_tags(trim(dojo.byId("verrouide").value),'').length;
                                        if (trim(strip_tags(editor2.get("value")),'').length > 3000) {
                                            document.getElementById('msgerrverrou').style.display = 'block';
                                        } else {
                                            document.getElementById('msgerrverrou').style.display = 'none';
                                        }
                                    });
                                    dojo.connect(editor2, "onClick", this, function(event) {
                                        dojo.byId("verrouide").value = editor2.get("value");
                                        document.getElementById('cptverrou').innerHTML = "<?php echo TXT_NBCARACT.' : '; ?>"+ strip_tags(trim(dojo.byId("verrouide").value),'').length;
                                        if (trim(strip_tags(editor2.get("value")),'').length > 3000) {
                                            document.getElementById('msgerrverrou').style.display = 'block';
                                        } else {
                                            document.getElementById('msgerrverrou').style.display = 'none';
                                        }
                                    });
                                    dojo.connect(editor2, "onBlur", this, function(event) {
                                        dojo.byId("verrouide").value = editor2.get("value");
                                        document.getElementById('cptverrou').innerHTML = "<?php echo TXT_NBCARACT.' : '; ?>"+ strip_tags(trim(dojo.byId("verrouide").value),'').length;
                                        if (trim(strip_tags(editor2.get("value")),'').length > 3000) {
                                            document.getElementById('msgerrverrou').style.display = 'block';
                                        } else {
                                            document.getElementById('msgerrverrou').style.display = 'none';
                                        }
                                    });
                                    dojo.connect(editor2, "onLoad", this, function(event) {
                                        document.getElementById('cptverrou').style.display = 'block';
                                        dojo.byId("verrouide").value = editor2.get("value");
                                        document.getElementById('cptverrou').innerHTML = "<?php echo TXT_NBCARACT.' : '; ?>"+ strip_tags(trim(dojo.byId("verrouide").value),'').length;
                                    });
//----------------------------------------------------------------------------------------------------------------------------------------------------
//                                                                              ETAPE AUTRE CENTRALE 
//----------------------------------------------------------------------------------------------------------------------------------------------------
                                    dojo.connect(editor5, "onKeyPress", this, function(event) {
                                        dojo.byId("etautrecentrale").value = editor5.get("value");                                        
                                        document.getElementById('cptetapeautrecentrale').innerHTML = "<?php echo TXT_NBCARACT.' : '; ?>"+ strip_tags(trim(dojo.byId("etautrecentrale").value),'').length;
                                        if (trim(strip_tags(editor5.get("value")),'').length > 3000) {
                                            document.getElementById('msgerretapeautrecentrale').style.display = 'block';
                                        } else {
                                            document.getElementById('msgerretapeautrecentrale').style.display = 'none';
                                        }
                                    });
                                    dojo.connect(editor5, "onClick", this, function(event) {
                                        dojo.byId("etautrecentrale").value = editor5.get("value");
                                        document.getElementById('cptetapeautrecentrale').innerHTML = "<?php echo TXT_NBCARACT.' : '; ?>"+ strip_tags(trim(dojo.byId("etautrecentrale").value),'').length;
                                        if (trim(strip_tags(editor5.get("value")),'').length > 3000) {
                                            document.getElementById('msgerretapeautrecentrale').style.display = 'block';
                                        } else {
                                            document.getElementById('msgerretapeautrecentrale').style.display = 'none';
                                        }
                                    });
                                    dojo.connect(editor5, "onBlur", this, function(event) {
                                        dojo.byId("etautrecentrale").value = editor5.get("value");
                                        document.getElementById('cptetapeautrecentrale').innerHTML = "<?php echo TXT_NBCARACT.' : '; ?>"+ strip_tags(trim(dojo.byId("etautrecentrale").value),'').length;
                                        if (trim(strip_tags(editor5.get("value")),'').length > 3000) {
                                            document.getElementById('msgerretapeautrecentrale').style.display = 'block';
                                        } else {
                                            document.getElementById('msgerretapeautrecentrale').style.display = 'none';
                                        }
                                    });
                                    dojo.connect(editor5, "onLoad", this, function(event) {
                                        document.getElementById('cptetapeautrecentrale').style.display = 'block';
                                        dojo.byId("etautrecentrale").value = editor5.get("value");
                                        document.getElementById('cptetapeautrecentrale').innerHTML = "<?php echo TXT_NBCARACT.' : '; ?>"+ strip_tags(trim(dojo.byId("etautrecentrale").value),'').length;
                                    });

//----------------------------------------------------------------------------------------------------------------------------------------------------
//                                                                              REUSSITE
//---------------------------------------------------------------------------------------------------------------------------------------------------
                                    dojo.connect(editor3, "onKeyPress", this, function(event) {
                                        dojo.byId("reussit").value = editor3.get("value");
                                        document.getElementById('cptreussite').innerHTML = "<?php echo TXT_NBCARACT.' : '; ?>"+ strip_tags(trim(dojo.byId("reussit").value),'').length;
                                        if (trim(strip_tags(editor3.get("value")),'').length > 3000) {
                                            document.getElementById('msgerrreussite').style.display = 'block';
                                        } else {
                                            document.getElementById('msgerrreussite').style.display = 'none';
                                        }
                                    });
                                    dojo.connect(editor3, "onClick", this, function(event) {
                                        dojo.byId("reussit").value = editor3.get("value");
                                        document.getElementById('cptreussite').innerHTML = "<?php echo TXT_NBCARACT.' : '; ?>"+ strip_tags(trim(dojo.byId("reussit").value),'').length;
                                        if (trim(strip_tags(editor3.get("value")),'').length > 3000) {
                                            document.getElementById('msgerrreussite').style.display = 'block';
                                        } else {
                                            document.getElementById('msgerrreussite').style.display = 'none';
                                        }
                                    });
                                    dojo.connect(editor3, "onBlur", this, function(event) {
                                        dojo.byId("reussit").value = editor3.get("value");
                                        document.getElementById('cptreussite').innerHTML = "<?php echo TXT_NBCARACT.' : '; ?>"+ strip_tags(trim(dojo.byId("reussit").value),'').length;
                                        if (trim(strip_tags(editor3.get("value")),'').length > 3000) {
                                            document.getElementById('msgerrreussite').style.display = 'block';
                                        } else {
                                            document.getElementById('msgerrreussite').style.display = 'none';
                                        }
                                    });
                                    dojo.connect(editor3, "onLoad", this, function(event) {
                                        dojo.byId("reussit").value = editor3.get("value");
                                        document.getElementById('cptreussite').innerHTML = "<?php echo TXT_NBCARACT.' : '; ?>"+ strip_tags(trim(dojo.byId("reussit").value),'').length;
                                    });

                                });
                            })
                        </script>
                        <?php
                        //RECUPERATION DES RESSOURCES SELECTIONNEES
                        $row =$manager->getListbyArray("SELECT DISTINCT libelleressource,idressource FROM ressource,ressourceprojet,projet
                        WHERE idressource_ressource = idressource AND idprojet_projet =idprojet AND idprojet =?",array($idprojet));
                        $nbrow= count($row);
                        if($nbrow!=0){
                            for ($i = 0;$i <$nbrow;$i++) {
                                $ressource[]  ='re'.$row[$i]['idressource'];
                            }
                            $nbressource=count($ressource);
                        }else{
                            $nbressource=0;
                        }                                                
                        //RECUPERATION DES CENTRALES SELECTIONNEES
                        $row =$manager->getList2("SELECT DISTINCT libellecentrale FROM centrale c,projetautrecentrale p  WHERE c.idcentrale =p.idcentrale AND idprojet =?",$idprojet);
                        $nbcentrale=count($row);
                        for ($i = 0;$i < $nbcentrale;$i++) {
                            $autrecentrale[]  =str_replace('-','',$row[$i]['libellecentrale']);
                        }
                        
                        //RECUPERATION DES CENTRALES DE PROXIMITE SELECTIONNEES
                        $row =$manager->getList2("SELECT  idcentraleproximite  FROM centraleproximiteprojet  WHERE idprojet =?",$idprojet);
                        $nbcentraleproximite=count($row);                        
                        for ($i = 0;$i < $nbcentraleproximite;$i++) {
                            $centrale_Proximite[]  ='cp'.$row[$i]['idcentraleproximite'];
                        }                        
                            BD::deconnecter();
                        ?>
                        
                        <?php if (strpos($_SERVER['HTTP_USER_AGENT'], 'MSIE') !== FALSE) {?>
                                <script>
                                    require(["dojo/ready"], function(ready) {
                                        ready(function() {//MSIE
                                            '<?php for ( $i=0;$i < $nbcentraleproximite; $i++){?>'
                                            var centralep = '<?php echo $centrale_Proximite[$i] ?>';                                    
                                            dijit.byId(centralep).set('checked', true);
                                            '<?php } ?>'
                                        });
                                    });
                                </script>

                                <script>
                                    require(["dojo/ready"], function(ready) {
                                        ready(function() {//MSIE
                                            '<?php for ( $i=0;$i < $nbressource; $i++){?>'
                                            var ressource = '<?php echo $ressource[$i] ?>';
                                            dijit.byId(ressource).set('checked', true);
                                            '<?php } ?>'
                                        });
                                    });
                                </script>
                                <script>
                                    require(["dojo/ready"], function(ready) {
                                        ready(function() {//MSIE                                
                                        '<?php for ( $i=0;$i < $nbcentrale; $i++){?>'
                                        var centrale = '<?php echo $autrecentrale[$i] ?>';
                                        dijit.byId(centrale).set('checked', true);
                                        '<?php } ?>'
                                        });
                                    });
                                </script>
                        <?php  }else{?>
                                <script>
                                    require(["dojo/ready"], function(ready) {
                                        ready(function() {//FIREFOX                                    
                                            '<?php for ( $i=0;$i < $nbressource; $i++){?>'
                                            var ressource = '<?php echo $ressource[$i] ?>';
                                            dijit.byId(document.getElementById(ressource).id).setValue(true);
                                            '<?php }?>'

                                        });
                                    });
                                </script>
                               <script>
                                    require(["dojo/ready"], function(ready) {
                                        ready(function() {//FIREFOX
                                            '<?php for ( $i=0;$i < $nbcentrale; $i++){?>'
                                            var centrale = '<?php echo $autrecentrale[$i] ?>';
                                            dijit.byId(document.getElementById(centrale).id).setValue(true);
                                            ' <?php }?> '
                                        });
                                    });
                                </script> 
                                <script>                                                                   
                                    require(["dojo/ready"], function(ready) {
                                        ready(function() {//FIREFOX 
                                            '<?php for ( $i=0;$i < $nbcentraleproximite; $i++){?>'
                                            var centralep = '<?php echo $centrale_Proximite[$i] ?>';                                    
                                            dijit.byId(document.getElementById(centralep).id).setValue(true);
                                            '<?php }?> '
                                        });
                                    });
                                </script>  
                        <?php }?>